
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="A simple example with AI Agents" name="description"/>
<meta content="SupportVectors" name="author"/>
<link href="https://supportvectors.ai/metamorphosis/metamorphosis/mcp/TextModifiers/" rel="canonical"/>
<link href="../" rel="prev"/>
<link href="../../agents/" rel="next"/>
<link href="../../../images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.18" name="generator"/>
<title>TextModifiers - SupportVectors MetaMorphosis</title>
<link href="../../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Lora:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Lora";--md-code-font:"Roboto Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../stylesheets/supportvectors.css" rel="stylesheet"/>
<link href="../../../css/ansi-colours.css" rel="stylesheet"/>
<link href="../../../css/jupyter-cells.css" rel="stylesheet"/>
<link href="../../../css/pandas-dataframe.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="gray" data-md-color-primary="light-blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#textmodifiers-class">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="SupportVectors MetaMorphosis" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="SupportVectors MetaMorphosis">
<img alt="logo" src="../../../images/overlapping_logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            SupportVectors MetaMorphosis
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              TextModifiers
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="gray" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="SupportVectors MetaMorphosis" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="SupportVectors MetaMorphosis">
<img alt="logo" src="../../../images/overlapping_logo.png"/>
</a>
    SupportVectors MetaMorphosis
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../architecture/">
<span class="md-ellipsis">
    Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Package Documentation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Package Documentation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
<span class="md-ellipsis">
    MCP Package
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            MCP Package
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    TextModifiers
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    TextModifiers
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers">
<span class="md-ellipsis">
      TextModifiers
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.__init__">
<span class="md-ellipsis">
      __init__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.evaluate_review_text">
<span class="md-ellipsis">
      evaluate_review_text
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.extract_achievements">
<span class="md-ellipsis">
      extract_achievements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.get_model_info">
<span class="md-ellipsis">
      get_model_info
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.rationalize_text">
<span class="md-ellipsis">
      rationalize_text
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.summarize">
<span class="md-ellipsis">
      summarize
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#class-architecture">
<span class="md-ellipsis">
      Class Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#initialization">
<span class="md-ellipsis">
      Initialization
    </span>
</a>
<nav aria-label="Initialization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#constructor">
<span class="md-ellipsis">
      Constructor
    </span>
</a>
<nav aria-label="Constructor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#llm-clients">
<span class="md-ellipsis">
      LLM Clients
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prompt-templates">
<span class="md-ellipsis">
      Prompt Templates
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-methods">
<span class="md-ellipsis">
      Core Methods
    </span>
</a>
<nav aria-label="Core Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-text-summarization">
<span class="md-ellipsis">
      1. Text Summarization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-text-rationalization-copy-editing">
<span class="md-ellipsis">
      2. Text Rationalization (Copy Editing)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-achievement-extraction">
<span class="md-ellipsis">
      3. Achievement Extraction
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-review-quality-evaluation">
<span class="md-ellipsis">
      4. Review Quality Evaluation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#utility-methods">
<span class="md-ellipsis">
      Utility Methods
    </span>
</a>
<nav aria-label="Utility Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-information-introspection">
<span class="md-ellipsis">
      Model Information Introspection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-details-logging">
<span class="md-ellipsis">
      Model Details Logging
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#design-patterns">
<span class="md-ellipsis">
      Design Patterns
    </span>
</a>
<nav aria-label="Design Patterns" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#validation-first-design">
<span class="md-ellipsis">
      Validation-First Design
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fail-fast-error-handling">
<span class="md-ellipsis">
      Fail-Fast Error Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#structured-output-pattern">
<span class="md-ellipsis">
      Structured Output Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#template-driven-prompting">
<span class="md-ellipsis">
      Template-Driven Prompting
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error Handling
    </span>
</a>
<nav aria-label="Error Handling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#exception-hierarchy">
<span class="md-ellipsis">
      Exception Hierarchy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-context">
<span class="md-ellipsis">
      Error Context
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-considerations">
<span class="md-ellipsis">
      Performance Considerations
    </span>
</a>
<nav aria-label="Performance Considerations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#llm-client-reuse">
<span class="md-ellipsis">
      LLM Client Reuse
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prompt-template-caching">
<span class="md-ellipsis">
      Prompt Template Caching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#token-optimization">
<span class="md-ellipsis">
      Token Optimization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#memory-management">
<span class="md-ellipsis">
      Memory Management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing">
<span class="md-ellipsis">
      Testing
    </span>
</a>
<nav aria-label="Testing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-tests">
<span class="md-ellipsis">
      Unit Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-tests">
<span class="md-ellipsis">
      Integration Tests
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#migration-guide">
<span class="md-ellipsis">
      Migration Guide
    </span>
</a>
<nav aria-label="Migration Guide" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#from-v0x-to-v10">
<span class="md-ellipsis">
      From v0.x to v1.0
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#see-also">
<span class="md-ellipsis">
      See Also
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-ellipsis">
    Agents Package
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            Agents Package
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../agents/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-ellipsis">
    Core Modules
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            Core Modules
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../datamodel/">
<span class="md-ellipsis">
    Data Models
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../exceptions.md">
<span class="md-ellipsis">
    Exceptions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../utilities.md">
<span class="md-ellipsis">
    Utilities
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../model_registry.md">
<span class="md-ellipsis">
    Model Registry
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Examples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    Basic Processing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            Basic Processing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/summarizer_usage.md">
<span class="md-ellipsis">
    Summarizer Usage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/rationalize_usage.md">
<span class="md-ellipsis">
    Copy Editor Usage
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-ellipsis">
    Advanced Processing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            Advanced Processing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/extract_achievements_usage/">
<span class="md-ellipsis">
    Achievement Extraction
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/review_text_evaluator_usage.md">
<span class="md-ellipsis">
    Quality Evaluation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-ellipsis">
    Visualization
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            Visualization
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/visualize_evaluation_radar.md">
<span class="md-ellipsis">
    Radar Charts
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Project Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Project Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    Tips &amp; Tricks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            Tips &amp; Tricks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../project-guide/tips-and-tricks/cuda-hell/">
<span class="md-ellipsis">
    CUDA Issues
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Notebooks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../notebooks/supportvectors-common/">
<span class="md-ellipsis">
    Common Patterns
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers">
<span class="md-ellipsis">
      TextModifiers
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.__init__">
<span class="md-ellipsis">
      __init__
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.evaluate_review_text">
<span class="md-ellipsis">
      evaluate_review_text
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.extract_achievements">
<span class="md-ellipsis">
      extract_achievements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.get_model_info">
<span class="md-ellipsis">
      get_model_info
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.rationalize_text">
<span class="md-ellipsis">
      rationalize_text
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#metamorphosis.mcp.text_modifiers.TextModifiers.summarize">
<span class="md-ellipsis">
      summarize
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#class-architecture">
<span class="md-ellipsis">
      Class Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#initialization">
<span class="md-ellipsis">
      Initialization
    </span>
</a>
<nav aria-label="Initialization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#constructor">
<span class="md-ellipsis">
      Constructor
    </span>
</a>
<nav aria-label="Constructor" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#llm-clients">
<span class="md-ellipsis">
      LLM Clients
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prompt-templates">
<span class="md-ellipsis">
      Prompt Templates
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-methods">
<span class="md-ellipsis">
      Core Methods
    </span>
</a>
<nav aria-label="Core Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-text-summarization">
<span class="md-ellipsis">
      1. Text Summarization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-text-rationalization-copy-editing">
<span class="md-ellipsis">
      2. Text Rationalization (Copy Editing)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-achievement-extraction">
<span class="md-ellipsis">
      3. Achievement Extraction
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-review-quality-evaluation">
<span class="md-ellipsis">
      4. Review Quality Evaluation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#utility-methods">
<span class="md-ellipsis">
      Utility Methods
    </span>
</a>
<nav aria-label="Utility Methods" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-information-introspection">
<span class="md-ellipsis">
      Model Information Introspection
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-details-logging">
<span class="md-ellipsis">
      Model Details Logging
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#design-patterns">
<span class="md-ellipsis">
      Design Patterns
    </span>
</a>
<nav aria-label="Design Patterns" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#validation-first-design">
<span class="md-ellipsis">
      Validation-First Design
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#fail-fast-error-handling">
<span class="md-ellipsis">
      Fail-Fast Error Handling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#structured-output-pattern">
<span class="md-ellipsis">
      Structured Output Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#template-driven-prompting">
<span class="md-ellipsis">
      Template-Driven Prompting
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling">
<span class="md-ellipsis">
      Error Handling
    </span>
</a>
<nav aria-label="Error Handling" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#exception-hierarchy">
<span class="md-ellipsis">
      Exception Hierarchy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-context">
<span class="md-ellipsis">
      Error Context
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-considerations">
<span class="md-ellipsis">
      Performance Considerations
    </span>
</a>
<nav aria-label="Performance Considerations" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#llm-client-reuse">
<span class="md-ellipsis">
      LLM Client Reuse
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prompt-template-caching">
<span class="md-ellipsis">
      Prompt Template Caching
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#token-optimization">
<span class="md-ellipsis">
      Token Optimization
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#memory-management">
<span class="md-ellipsis">
      Memory Management
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing">
<span class="md-ellipsis">
      Testing
    </span>
</a>
<nav aria-label="Testing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-tests">
<span class="md-ellipsis">
      Unit Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-tests">
<span class="md-ellipsis">
      Integration Tests
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#migration-guide">
<span class="md-ellipsis">
      Migration Guide
    </span>
</a>
<nav aria-label="Migration Guide" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#from-v0x-to-v10">
<span class="md-ellipsis">
      From v0.x to v1.0
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#see-also">
<span class="md-ellipsis">
      See Also
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="textmodifiers-class">TextModifiers Class<a class="headerlink" href="#textmodifiers-class" title="Permanent link">¶</a></h1>
<div class="doc doc-object doc-class">
<a id="metamorphosis.mcp.text_modifiers.TextModifiers"></a>
<div class="doc doc-contents first">
<p>LLM-backed text processing utilities with structured outputs.</p>
<p>This class provides text processing capabilities including summarization
and copy editing using OpenAI's language models. All methods return
structured Pydantic models for type safety and validation.</p>
<p>The class uses prompt templates loaded from external files and leverages
LangChain's structured output capabilities for reliable parsing.</p>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TextModifiers</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""LLM-backed text processing utilities with structured outputs.</span>

<span class="sd">    This class provides text processing capabilities including summarization</span>
<span class="sd">    and copy editing using OpenAI's language models. All methods return</span>
<span class="sd">    structured Pydantic models for type safety and validation.</span>

<span class="sd">    The class uses prompt templates loaded from external files and leverages</span>
<span class="sd">    LangChain's structured output capabilities for reliable parsing.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Initialize the TextModifiers with LLM chains and prompt templates.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ConfigurationError: If required environment variables are missing.</span>
<span class="sd">            FileOperationError: If prompt files cannot be loaded.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Initializing TextModifiers"</span><span class="p">)</span>

        <span class="c1"># Acquire LLM clients from the central registry</span>
        <span class="n">registry</span> <span class="o">=</span> <span class="n">get_model_registry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">summarizer_llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">copy_editor_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">copy_editor_llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">key_achievements_llm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span>

        <span class="c1"># Load prompt templates from files using utility functions</span>
        <span class="n">project_root</span> <span class="o">=</span> <span class="n">get_project_root</span><span class="p">()</span>
        <span class="n">prompts_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="s2">"prompts"</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Using prompts directory: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">prompts_dir</span><span class="p">)</span>

        <span class="c1"># Load as-is; no VOICE placeholder expected in the template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span><span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"summarizer_system_prompt.md"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span><span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"summarizer_user_prompt.md"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
            <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"key_achievements_system_prompt.md"</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
            <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"key_achievements_user_prompt.md"</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
            <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_rationalization_system_prompt.md"</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
            <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_rationalization_user_prompt.md"</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
            <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_evaluator_system_prompt.md"</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
            <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_evaluator_user_prompt.md"</span>
        <span class="p">)</span>

        <span class="c1"># Compose prompts with input placeholders for clarity.</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"TextModifiers initialized successfully"</span><span class="p">)</span>

    <span class="nd">@validate_call</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
        <span class="n">max_words</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizedText</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Summarize text using the configured LLM chain.</span>

<span class="sd">        Args:</span>
<span class="sd">            text: The input text to summarize.</span>
<span class="sd">            max_words: Maximum number of words in the summary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SummarizedText: Structured summary with the summarized text.</span>

<span class="sd">        Raises:</span>
<span class="sd">            PostconditionError: If the output validation fails.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"summarize: processing text (length=</span><span class="si">{}</span><span class="s2">, max_words=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">max_words</span><span class="p">)</span>
        <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"summarize"</span><span class="p">)</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_system_prompt</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">review</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"summarizer_llm: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span><span class="p">)</span>
        <span class="n">summarizer</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">SummarizedText</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">summarizer</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"summarize: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
                <span class="s2">"Summarization LLM invocation failed"</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">"summarize_llm_invocation"</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SummarizedText</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span><span class="p">:</span>
            <span class="n">raise_postcondition_error</span><span class="p">(</span>
                <span class="s2">"Summarization output validation failed"</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"has_text"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"summarized_text"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
                <span class="p">},</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"summarize_validation"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">"summarize: completed successfully (output_length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@validate_call</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">rationalize_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="n">CopyEditedText</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Rationalize text by correcting grammar, spelling, and formatting errors.</span>

<span class="sd">        This method performs text rationalization using an LLM-based copy editor that makes</span>
<span class="sd">        minor, localized corrections to improve the professional quality of text while</span>
<span class="sd">        preserving the original meaning, structure, and content. The rationalization process</span>
<span class="sd">        focuses on fixing:</span>

<span class="sd">        - Spelling errors and typos (e.g., "teh" → "the", "recieved" → "received")</span>
<span class="sd">        - Grammar issues (subject-verb agreement, tense consistency, articles)</span>
<span class="sd">        - Punctuation normalization (quotes, commas, dashes, parentheses)</span>
<span class="sd">        - Capitalization consistency (proper nouns, product names, teams)</span>
<span class="sd">        - Whitespace and formatting standardization</span>
<span class="sd">        - Casual shorthand replacement with formal equivalents (e.g., "w/" → "with")</span>

<span class="sd">        The method is specifically designed for employee self-reviews and similar business</span>
<span class="sd">        documents that may contain informal language, typos, or inconsistent formatting</span>
<span class="sd">        from being pasted from drafts or messaging platforms.</span>

<span class="sd">        **Preservation Guarantees:**</span>
<span class="sd">        - Original paragraph structure and ordering are maintained exactly</span>
<span class="sd">        - Numerical values and units remain identical (only formatting may be normalized)</span>
<span class="sd">        - Bullet points, headings, and section order are preserved</span>
<span class="sd">        - Author's voice and intent (first/third person) are retained</span>
<span class="sd">        - No content is added, removed, or significantly rewritten</span>

<span class="sd">        **Style Transformations:**</span>
<span class="sd">        - Converts informal shorthand to professional language when unambiguous</span>
<span class="sd">        - Normalizes product/tool names for consistency</span>
<span class="sd">        - Standardizes punctuation and spacing around units and symbols</span>
<span class="sd">        - Removes casual interjections while preserving meaning</span>
<span class="sd">        - Corrects double negatives in reduction statements (e.g., "reduced by -38%" → "reduced by 38%")  # noqa: E501</span>

<span class="sd">        Args:</span>
<span class="sd">            text: The input text to rationalize. Must be non-empty string containing</span>
<span class="sd">                the content to be copy-edited. Typically employee self-review text</span>
<span class="sd">                or similar business documents that need professional polish.</span>

<span class="sd">        Returns:</span>
<span class="sd">            CopyEditedText: A structured response containing:</span>
<span class="sd">                - copy_edited_text: The rationalized text with corrections applied</span>
<span class="sd">                - size: Estimated token count of the rationalized text</span>
<span class="sd">                - is_edited: Boolean indicating whether any changes were made</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the input text is empty or invalid.</span>
<span class="sd">            PostconditionError: If the LLM output validation fails or the structured</span>
<span class="sd">                response cannot be parsed correctly.</span>
<span class="sd">            ConfigurationError: If the copy editor LLM is not properly configured.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; modifier = TextModifiers()</span>
<span class="sd">            &gt;&gt;&gt; result = modifier.rationalize_text(</span>
<span class="sd">            ...     text="I migrated teh system w/ better performance. "</span>
<span class="sd">            ...          "Latency dropped by -38% after optimizations."</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; print(result.copy_edited_text)</span>
<span class="sd">            "I migrated the system with better performance. "</span>
<span class="sd">            "Latency dropped by 38% after optimizations."</span>
<span class="sd">            &gt;&gt;&gt; print(result.is_edited)</span>
<span class="sd">            True</span>

<span class="sd">        Note:</span>
<span class="sd">            This method uses the text_rationalization_system_prompt.md and</span>
<span class="sd">            text_rationalization_user_prompt.md templates to guide the LLM's</span>
<span class="sd">            behavior. The rationalization is performed by the copy_editor_llm</span>
<span class="sd">            configured in the model registry.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"rationalize_text: processing text (length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"rationalize_text"</span><span class="p">)</span>

        <span class="c1"># Construct the prompt using the text rationalization templates</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_system_prompt</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">EMPLOYEE_REVIEW_TEXT</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

        <span class="c1"># Create the rationalization chain with structured output</span>
        <span class="n">rationalizer</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_editor_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">CopyEditedText</span><span class="p">)</span>

        <span class="c1"># Invoke the chain with exception handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">rationalizer</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"rationalize_text: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
                <span class="s2">"Text rationalization LLM invocation failed"</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"rationalize_text_llm_invocation"</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">CopyEditedText</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">copy_edited_text</span><span class="p">:</span>
            <span class="n">raise_postcondition_error</span><span class="p">(</span>
                <span class="s2">"Text rationalization output validation failed"</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"has_text"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"copy_edited_text"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
                <span class="p">},</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"rationalize_text_validation"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">"rationalize_text: completed successfully (output_length=</span><span class="si">{}</span><span class="s2">, edited=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">copy_edited_text</span><span class="p">),</span>
            <span class="n">result</span><span class="o">.</span><span class="n">is_edited</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># =========================================================================</span>

    <span class="nd">@validate_call</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_achievements</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AchievementsList</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Extract key achievements from employee self-review text.</span>

<span class="sd">        This method analyzes employee self-review text and extracts up to 10 key achievements</span>
<span class="sd">        with structured metadata including impact areas, metrics, timeframes, and</span>
<span class="sd">        collaboration details. The extraction focuses on identifying concrete outcomes</span>
<span class="sd">        and business impact rather than activities or tasks.</span>

<span class="sd">        The method uses an LLM-based achievement extractor that follows strict guidelines</span>
<span class="sd">        to identify and rank achievements by:</span>
<span class="sd">        - Business/customer impact (revenue, cost, risk, user outcomes)</span>
<span class="sd">        - Reliability/quality/security improvements (SLO/MTTR/incidents/defects)</span>
<span class="sd">        - Breadth of ownership (Cross-team/Org-wide &gt; TechLead &gt; IC)</span>
<span class="sd">        - Adoption/usage and external validation</span>
<span class="sd">        - Recency (tie-breaker)</span>

<span class="sd">        **Achievement Structure:**</span>
<span class="sd">        Each extracted achievement includes:</span>
<span class="sd">        - **title**: Concise, outcome-oriented label (≤12 words)</span>
<span class="sd">        - **outcome**: Impact/result description (≤40 words)</span>
<span class="sd">        - **impact_area**: Categorized impact type (reliability, performance, security, etc.)</span>
<span class="sd">        - **metric_strings**: Verbatim numbers/units from the review text</span>
<span class="sd">        - **timeframe**: Explicit time period if stated (e.g., "Q2 2025", "H1")</span>
<span class="sd">        - **ownership_scope**: Leadership level if explicit (IC, TechLead, Manager, etc.)</span>
<span class="sd">        - **collaborators**: Named people/teams if mentioned</span>

<span class="sd">        **Quality Guarantees:**</span>
<span class="sd">        - No invented metrics, dates, or collaborators - only explicit information</span>
<span class="sd">        - Numbers and units copied exactly as they appear in the review</span>
<span class="sd">        - Achievements are deduplicated and ranked by impact</span>
<span class="sd">        - Maximum of 10 achievements returned, fewer if insufficient quality achievements exist</span>

<span class="sd">        Args:</span>
<span class="sd">            text: The employee self-review text to analyze. Must be non-empty string</span>
<span class="sd">                containing the review content from which to extract achievements.</span>
<span class="sd">                Typically contains mixed content (tasks, outcomes, anecdotes) that</span>
<span class="sd">                needs to be parsed for concrete accomplishments.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AchievementsList: A structured response containing:</span>
<span class="sd">                - items: List of up to 10 Achievement objects ranked by impact</span>
<span class="sd">                - size: Token estimate of concatenated titles and outcomes</span>
<span class="sd">                - unit: Always "tokens"</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the input text is empty or invalid.</span>
<span class="sd">            PostconditionError: If the LLM output validation fails or the structured</span>
<span class="sd">                response cannot be parsed correctly.</span>
<span class="sd">            ConfigurationError: If the key achievements LLM is not properly configured.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; modifier = TextModifiers()</span>
<span class="sd">            &gt;&gt;&gt; result = modifier.extract_achievements(</span>
<span class="sd">            ...     text="I reduced checkout p95 latency from 480ms to 190ms in H1 2025 "</span>
<span class="sd">            ...          "by redesigning the caching layer with the Payments and SRE teams. "</span>
<span class="sd">            ...          "This improved conversion rates during peak traffic periods."</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; print(result.items[0].title)</span>
<span class="sd">            "Cut checkout p95 latency"</span>
<span class="sd">            &gt;&gt;&gt; print(result.items[0].impact_area)</span>
<span class="sd">            "performance"</span>
<span class="sd">            &gt;&gt;&gt; print(result.items[0].metric_strings)</span>
<span class="sd">            ["480ms", "190ms"]</span>

<span class="sd">        Note:</span>
<span class="sd">            This method uses the key_achievements_system_prompt.md and</span>
<span class="sd">            key_achievements_user_prompt.md templates to guide the LLM's behavior.</span>
<span class="sd">            The extraction is performed by the key_achievements_llm configured</span>
<span class="sd">            in the model registry.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"extract_achievements: processing text (length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"extract_achievements"</span><span class="p">)</span>

        <span class="c1"># Construct the prompt using the key achievements templates</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_system_prompt</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">EMPLOYEE_REVIEW_TEXT</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

        <span class="c1"># Create the achievement extraction chain with structured output</span>
        <span class="n">extractor</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">AchievementsList</span><span class="p">)</span>

        <span class="c1"># Invoke the chain with exception handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"extract_achievements: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
                <span class="s2">"Achievement extraction LLM invocation failed"</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"extract_achievements_llm_invocation"</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">AchievementsList</span><span class="p">):</span>
            <span class="n">raise_postcondition_error</span><span class="p">(</span>
                <span class="s2">"Achievement extraction output validation failed"</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"has_items"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"items"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
                <span class="p">},</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"extract_achievements_validation"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">"extract_achievements: completed successfully (items_count=</span><span class="si">{}</span><span class="s2">, total_size=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
            <span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># =========================================================================</span>

    <span class="nd">@validate_call</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">evaluate_review_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="n">ReviewScorecard</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Evaluate the writing quality of employee self-review text.</span>

<span class="sd">        This method analyzes employee self-review text and provides a comprehensive</span>
<span class="sd">        assessment of writing quality across six key dimensions. The evaluation</span>
<span class="sd">        focuses on the quality of the writing itself, not job performance, to help</span>
<span class="sd">        HR partners and engineering leaders quickly assess review quality.</span>

<span class="sd">        The method uses an LLM-based evaluator that scores the review on:</span>
<span class="sd">        - **OutcomeOverActivity** (25%): Emphasis on concrete outcomes vs. task lists</span>
<span class="sd">        - **QuantitativeSpecificity** (25%): Use of metrics, numbers, and baselines</span>
<span class="sd">        - **ClarityCoherence** (15%): Logical flow and readability</span>
<span class="sd">        - **Conciseness** (15%): Efficient, non-redundant expression</span>
<span class="sd">        - **OwnershipLeadership** (10%): Clear ownership and leadership signals</span>
<span class="sd">        - **Collaboration** (10%): Evidence of cross-team work and partnerships</span>

<span class="sd">        **Scoring System:**</span>
<span class="sd">        Each dimension is scored 0-100 using anchor levels (20/40/60/80/95) with</span>
<span class="sd">        specific rubrics. The overall score is a weighted average that determines</span>
<span class="sd">        the verdict: excellent (≥85), strong (70-84), mixed (50-69), weak (&lt;50).</span>

<span class="sd">        **Output Structure:**</span>
<span class="sd">        - Individual scores and rationales for each dimension</span>
<span class="sd">        - Specific, actionable improvement suggestions</span>
<span class="sd">        - Weighted overall score and verdict classification</span>
<span class="sd">        - Optional flags for common issues (e.g., no_numbers_detected, short_review)</span>
<span class="sd">        - Radar chart data for visualization</span>

<span class="sd">        Args:</span>
<span class="sd">            text: The employee self-review text to evaluate. Must be non-empty string</span>
<span class="sd">                containing the review content to be assessed for writing quality.</span>
<span class="sd">                Typically contains mixed content about achievements, projects, and</span>
<span class="sd">                activities that needs quality assessment.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ReviewScorecard: A structured assessment containing:</span>
<span class="sd">                - metrics: List of 6 MetricScore objects with scores, rationales, suggestions</span>
<span class="sd">                - overall: Weighted average score (0-100)</span>
<span class="sd">                - verdict: Quality classification (excellent/strong/mixed/weak)</span>
<span class="sd">                - notes: Optional flags for specific issues detected</span>
<span class="sd">                - radar_labels: Metric names for chart visualization</span>
<span class="sd">                - radar_values: Corresponding scores for chart visualization</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValidationError: If the input text is empty or invalid.</span>
<span class="sd">            PostconditionError: If the LLM output validation fails or the structured</span>
<span class="sd">                response cannot be parsed correctly.</span>
<span class="sd">            ConfigurationError: If the review text evaluator LLM is not properly configured.</span>

<span class="sd">        Example:</span>
<span class="sd">            &gt;&gt;&gt; modifier = TextModifiers()</span>
<span class="sd">            &gt;&gt;&gt; result = modifier.evaluate_review_text(</span>
<span class="sd">            ...     text="I reduced latency from 480ms to 190ms by optimizing the cache. "</span>
<span class="sd">            ...          "This improved user experience and reduced server costs by 15%."</span>
<span class="sd">            ... )</span>
<span class="sd">            &gt;&gt;&gt; print(result.overall)</span>
<span class="sd">            75</span>
<span class="sd">            &gt;&gt;&gt; print(result.verdict)</span>
<span class="sd">            "strong"</span>
<span class="sd">            &gt;&gt;&gt; print(result.metrics[0].name)</span>
<span class="sd">            "OutcomeOverActivity"</span>

<span class="sd">        Note:</span>
<span class="sd">            This method uses the text_evaluator_system_prompt.md and</span>
<span class="sd">            text_evaluator_user_prompt.md templates to guide the LLM's behavior.</span>
<span class="sd">            The evaluation is performed by the review_text_evaluator_llm configured</span>
<span class="sd">            in the model registry.</span>
<span class="sd">        """</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"evaluate_review_text: processing text (length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"evaluate_review_text"</span><span class="p">)</span>

        <span class="c1"># Construct the prompt using the text evaluator templates</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_system_prompt</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">EMPLOYEE_REVIEW_TEXT</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

        <span class="c1"># Create the evaluation chain with structured output</span>
        <span class="n">evaluator</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">ReviewScorecard</span><span class="p">)</span>

        <span class="c1"># Invoke the chain with exception handling</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"evaluate_review_text: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
                <span class="s2">"Review text evaluation LLM invocation failed"</span><span class="p">,</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"evaluate_review_text_llm_invocation"</span><span class="p">,</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

        <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ReviewScorecard</span><span class="p">)</span>
            <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">metrics</span>
            <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span>
        <span class="p">):</span>
            <span class="n">raise_postcondition_error</span><span class="p">(</span>
                <span class="s2">"Review text evaluation output validation failed"</span><span class="p">,</span>
                <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="s2">"has_metrics"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"metrics"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
                    <span class="s2">"metrics_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"metrics"</span><span class="p">,</span> <span class="p">[])),</span>
                <span class="p">},</span>
                <span class="n">operation</span><span class="o">=</span><span class="s2">"evaluate_review_text_validation"</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">"evaluate_review_text: completed successfully (overall_score=</span><span class="si">{}</span><span class="s2">, verdict=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">overall</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">verdict</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="c1"># =========================================================================</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get model configuration information for a specific method.</span>

<span class="sd">        Args:</span>
<span class="sd">            method: The method name (e.g., "summarize", "rationalize_text", </span>
<span class="sd">                "extract_achievements", "evaluate_review_text").</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dictionary containing model configuration or None if not found.</span>
<span class="sd">        """</span>
        <span class="n">method_to_llm</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"summarize"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span><span class="p">,</span>
            <span class="s2">"rationalize_text"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_editor_llm</span><span class="p">,</span>
            <span class="s2">"extract_achievements"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_llm</span><span class="p">,</span>
            <span class="s2">"evaluate_review_text"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">llm</span> <span class="o">=</span> <span class="n">method_to_llm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">llm</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Extract configuration from the LLM instance</span>
        <span class="n">model_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"model"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"model_name"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
            <span class="s2">"temperature"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"temperature"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
            <span class="s2">"max_tokens"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"max_tokens"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
            <span class="s2">"timeout"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"request_timeout"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Add optional parameters if they exist</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"top_p"</span><span class="p">,</span> <span class="s2">"frequency_penalty"</span><span class="p">,</span> <span class="s2">"presence_penalty"</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">model_info</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">model_info</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_log_model_details_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Log the LLM model details as a table for the given TextModifiers method.</span>

<span class="sd">        Args:</span>
<span class="sd">            method: The name of the method (e.g., "summarize", "rationalize_text").</span>
<span class="sd">        """</span>
        <span class="c1"># Defensive: ensure the model config is present and has expected keys</span>
        <span class="n">model_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_model_info</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">model_info</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">"No model info found for method '</span><span class="si">{}</span><span class="s2">'"</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Prepare table rows</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">"Model"</span><span class="p">,</span> <span class="n">model_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">"Temperature"</span><span class="p">,</span> <span class="n">model_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"temperature"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">"Max Tokens"</span><span class="p">,</span> <span class="n">model_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"max_tokens"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)),</span>
            <span class="p">(</span><span class="s2">"Timeout"</span><span class="p">,</span> <span class="n">model_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"timeout"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="c1"># Optional fields</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"top_p"</span><span class="p">,</span> <span class="s2">"frequency_penalty"</span><span class="p">,</span> <span class="s2">"presence_penalty"</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">model_info</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">"_"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">model_info</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>

        <span class="c1"># Format as table</span>
        <span class="n">col_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="n">table_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'Parameter'</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">col_width</span><span class="p">)</span><span class="si">}</span><span class="s2">| Value"</span><span class="p">,</span>
            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'-'</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">col_width</span><span class="p">)</span><span class="si">}</span><span class="s2">|</span><span class="si">{</span><span class="s1">'-'</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">20</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">table_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="n">col_width</span><span class="p">)</span><span class="si">}</span><span class="s2">| </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"LLM Model Details for '</span><span class="si">{}</span><span class="s2">':</span><span class="se">\n</span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">table_lines</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="metamorphosis.mcp.text_modifiers.TextModifiers.__init__">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>
<a class="headerlink" href="#metamorphosis.mcp.text_modifiers.TextModifiers.__init__" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Initialize the TextModifiers with LLM chains and prompt templates.</p>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="ConfigurationError">ConfigurationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If required environment variables are missing.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.FileOperationError">FileOperationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If prompt files cannot be loaded.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Initialize the TextModifiers with LLM chains and prompt templates.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ConfigurationError: If required environment variables are missing.</span>
<span class="sd">        FileOperationError: If prompt files cannot be loaded.</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Initializing TextModifiers"</span><span class="p">)</span>

    <span class="c1"># Acquire LLM clients from the central registry</span>
    <span class="n">registry</span> <span class="o">=</span> <span class="n">get_model_registry</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">summarizer_llm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">copy_editor_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">copy_editor_llm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">key_achievements_llm</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span> <span class="o">=</span> <span class="n">registry</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span>

    <span class="c1"># Load prompt templates from files using utility functions</span>
    <span class="n">project_root</span> <span class="o">=</span> <span class="n">get_project_root</span><span class="p">()</span>
    <span class="n">prompts_dir</span> <span class="o">=</span> <span class="n">project_root</span> <span class="o">/</span> <span class="s2">"prompts"</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"Using prompts directory: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="n">prompts_dir</span><span class="p">)</span>

    <span class="c1"># Load as-is; no VOICE placeholder expected in the template</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span><span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"summarizer_system_prompt.md"</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span><span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"summarizer_user_prompt.md"</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
        <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"key_achievements_system_prompt.md"</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
        <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"key_achievements_user_prompt.md"</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
        <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_rationalization_system_prompt.md"</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
        <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_rationalization_user_prompt.md"</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
        <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_evaluator_system_prompt.md"</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span>
        <span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"text_evaluator_user_prompt.md"</span>
    <span class="p">)</span>

    <span class="c1"># Compose prompts with input placeholders for clarity.</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"TextModifiers initialized successfully"</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="metamorphosis.mcp.text_modifiers.TextModifiers.evaluate_review_text">
<code class="highlight language-python"><span class="n">evaluate_review_text</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></code>
<a class="headerlink" href="#metamorphosis.mcp.text_modifiers.TextModifiers.evaluate_review_text" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Evaluate the writing quality of employee self-review text.</p>
<p>This method analyzes employee self-review text and provides a comprehensive
assessment of writing quality across six key dimensions. The evaluation
focuses on the quality of the writing itself, not job performance, to help
HR partners and engineering leaders quickly assess review quality.</p>
<p>The method uses an LLM-based evaluator that scores the review on:
- <strong>OutcomeOverActivity</strong> (25%): Emphasis on concrete outcomes vs. task lists
- <strong>QuantitativeSpecificity</strong> (25%): Use of metrics, numbers, and baselines
- <strong>ClarityCoherence</strong> (15%): Logical flow and readability
- <strong>Conciseness</strong> (15%): Efficient, non-redundant expression
- <strong>OwnershipLeadership</strong> (10%): Clear ownership and leadership signals
- <strong>Collaboration</strong> (10%): Evidence of cross-team work and partnerships</p>
<p><strong>Scoring System:</strong>
Each dimension is scored 0-100 using anchor levels (20/40/60/80/95) with
specific rubrics. The overall score is a weighted average that determines
the verdict: excellent (≥85), strong (70-84), mixed (50-69), weak (&lt;50).</p>
<p><strong>Output Structure:</strong>
- Individual scores and rationales for each dimension
- Specific, actionable improvement suggestions
- Weighted overall score and verdict classification
- Optional flags for common issues (e.g., no_numbers_detected, short_review)
- Radar chart data for visualization</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>text</code>
</td>
<td>
<code><span title="typing.Annotated">Annotated</span>[<span title="str">str</span>, <span title="pydantic.Field">Field</span>(min_length=1)]</code>
</td>
<td>
<div class="doc-md-description">
<p>The employee self-review text to evaluate. Must be non-empty string
containing the review content to be assessed for writing quality.
Typically contains mixed content about achievements, projects, and
activities that needs quality assessment.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>ReviewScorecard</code></td> <td>
<code><span title="metamorphosis.datamodel.ReviewScorecard">ReviewScorecard</span></code>
</td>
<td>
<div class="doc-md-description">
<p>A structured assessment containing:
- metrics: List of 6 MetricScore objects with scores, rationales, suggestions
- overall: Weighted average score (0-100)
- verdict: Quality classification (excellent/strong/mixed/weak)
- notes: Optional flags for specific issues detected
- radar_labels: Metric names for chart visualization
- radar_values: Corresponding scores for chart visualization</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.ValidationError">ValidationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the input text is empty or invalid.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.PostconditionError">PostconditionError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the LLM output validation fails or the structured
response cannot be parsed correctly.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="ConfigurationError">ConfigurationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the review text evaluator LLM is not properly configured.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<blockquote>
<blockquote>
<blockquote>
<p>modifier = TextModifiers()
result = modifier.evaluate_review_text(
...     text="I reduced latency from 480ms to 190ms by optimizing the cache. "
...          "This improved user experience and reduced server costs by 15%."
... )
print(result.overall)
75
print(result.verdict)
"strong"
print(result.metrics[0].name)
"OutcomeOverActivity"</p>
</blockquote>
</blockquote>
</blockquote>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>This method uses the text_evaluator_system_prompt.md and
text_evaluator_user_prompt.md templates to guide the LLM's behavior.
The evaluation is performed by the review_text_evaluator_llm configured
in the model registry.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_review_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="n">ReviewScorecard</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Evaluate the writing quality of employee self-review text.</span>

<span class="sd">    This method analyzes employee self-review text and provides a comprehensive</span>
<span class="sd">    assessment of writing quality across six key dimensions. The evaluation</span>
<span class="sd">    focuses on the quality of the writing itself, not job performance, to help</span>
<span class="sd">    HR partners and engineering leaders quickly assess review quality.</span>

<span class="sd">    The method uses an LLM-based evaluator that scores the review on:</span>
<span class="sd">    - **OutcomeOverActivity** (25%): Emphasis on concrete outcomes vs. task lists</span>
<span class="sd">    - **QuantitativeSpecificity** (25%): Use of metrics, numbers, and baselines</span>
<span class="sd">    - **ClarityCoherence** (15%): Logical flow and readability</span>
<span class="sd">    - **Conciseness** (15%): Efficient, non-redundant expression</span>
<span class="sd">    - **OwnershipLeadership** (10%): Clear ownership and leadership signals</span>
<span class="sd">    - **Collaboration** (10%): Evidence of cross-team work and partnerships</span>

<span class="sd">    **Scoring System:**</span>
<span class="sd">    Each dimension is scored 0-100 using anchor levels (20/40/60/80/95) with</span>
<span class="sd">    specific rubrics. The overall score is a weighted average that determines</span>
<span class="sd">    the verdict: excellent (≥85), strong (70-84), mixed (50-69), weak (&lt;50).</span>

<span class="sd">    **Output Structure:**</span>
<span class="sd">    - Individual scores and rationales for each dimension</span>
<span class="sd">    - Specific, actionable improvement suggestions</span>
<span class="sd">    - Weighted overall score and verdict classification</span>
<span class="sd">    - Optional flags for common issues (e.g., no_numbers_detected, short_review)</span>
<span class="sd">    - Radar chart data for visualization</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The employee self-review text to evaluate. Must be non-empty string</span>
<span class="sd">            containing the review content to be assessed for writing quality.</span>
<span class="sd">            Typically contains mixed content about achievements, projects, and</span>
<span class="sd">            activities that needs quality assessment.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ReviewScorecard: A structured assessment containing:</span>
<span class="sd">            - metrics: List of 6 MetricScore objects with scores, rationales, suggestions</span>
<span class="sd">            - overall: Weighted average score (0-100)</span>
<span class="sd">            - verdict: Quality classification (excellent/strong/mixed/weak)</span>
<span class="sd">            - notes: Optional flags for specific issues detected</span>
<span class="sd">            - radar_labels: Metric names for chart visualization</span>
<span class="sd">            - radar_values: Corresponding scores for chart visualization</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If the input text is empty or invalid.</span>
<span class="sd">        PostconditionError: If the LLM output validation fails or the structured</span>
<span class="sd">            response cannot be parsed correctly.</span>
<span class="sd">        ConfigurationError: If the review text evaluator LLM is not properly configured.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; modifier = TextModifiers()</span>
<span class="sd">        &gt;&gt;&gt; result = modifier.evaluate_review_text(</span>
<span class="sd">        ...     text="I reduced latency from 480ms to 190ms by optimizing the cache. "</span>
<span class="sd">        ...          "This improved user experience and reduced server costs by 15%."</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(result.overall)</span>
<span class="sd">        75</span>
<span class="sd">        &gt;&gt;&gt; print(result.verdict)</span>
<span class="sd">        "strong"</span>
<span class="sd">        &gt;&gt;&gt; print(result.metrics[0].name)</span>
<span class="sd">        "OutcomeOverActivity"</span>

<span class="sd">    Note:</span>
<span class="sd">        This method uses the text_evaluator_system_prompt.md and</span>
<span class="sd">        text_evaluator_user_prompt.md templates to guide the LLM's behavior.</span>
<span class="sd">        The evaluation is performed by the review_text_evaluator_llm configured</span>
<span class="sd">        in the model registry.</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"evaluate_review_text: processing text (length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"evaluate_review_text"</span><span class="p">)</span>

    <span class="c1"># Construct the prompt using the text evaluator templates</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_system_prompt</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_evaluator_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">EMPLOYEE_REVIEW_TEXT</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="c1"># Create the evaluation chain with structured output</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">ReviewScorecard</span><span class="p">)</span>

    <span class="c1"># Invoke the chain with exception handling</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">evaluator</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"evaluate_review_text: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
            <span class="s2">"Review text evaluation LLM invocation failed"</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"evaluate_review_text_llm_invocation"</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">ReviewScorecard</span><span class="p">)</span>
        <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">metrics</span>
        <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">metrics</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">6</span>
    <span class="p">):</span>
        <span class="n">raise_postcondition_error</span><span class="p">(</span>
            <span class="s2">"Review text evaluation output validation failed"</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">"has_metrics"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"metrics"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
                <span class="s2">"metrics_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"metrics"</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="p">},</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"evaluate_review_text_validation"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">"evaluate_review_text: completed successfully (overall_score=</span><span class="si">{}</span><span class="s2">, verdict=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span>
        <span class="n">result</span><span class="o">.</span><span class="n">overall</span><span class="p">,</span>
        <span class="n">result</span><span class="o">.</span><span class="n">verdict</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="metamorphosis.mcp.text_modifiers.TextModifiers.extract_achievements">
<code class="highlight language-python"><span class="n">extract_achievements</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></code>
<a class="headerlink" href="#metamorphosis.mcp.text_modifiers.TextModifiers.extract_achievements" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Extract key achievements from employee self-review text.</p>
<p>This method analyzes employee self-review text and extracts up to 10 key achievements
with structured metadata including impact areas, metrics, timeframes, and
collaboration details. The extraction focuses on identifying concrete outcomes
and business impact rather than activities or tasks.</p>
<p>The method uses an LLM-based achievement extractor that follows strict guidelines
to identify and rank achievements by:
- Business/customer impact (revenue, cost, risk, user outcomes)
- Reliability/quality/security improvements (SLO/MTTR/incidents/defects)
- Breadth of ownership (Cross-team/Org-wide &gt; TechLead &gt; IC)
- Adoption/usage and external validation
- Recency (tie-breaker)</p>
<p><strong>Achievement Structure:</strong>
Each extracted achievement includes:
- <strong>title</strong>: Concise, outcome-oriented label (≤12 words)
- <strong>outcome</strong>: Impact/result description (≤40 words)
- <strong>impact_area</strong>: Categorized impact type (reliability, performance, security, etc.)
- <strong>metric_strings</strong>: Verbatim numbers/units from the review text
- <strong>timeframe</strong>: Explicit time period if stated (e.g., "Q2 2025", "H1")
- <strong>ownership_scope</strong>: Leadership level if explicit (IC, TechLead, Manager, etc.)
- <strong>collaborators</strong>: Named people/teams if mentioned</p>
<p><strong>Quality Guarantees:</strong>
- No invented metrics, dates, or collaborators - only explicit information
- Numbers and units copied exactly as they appear in the review
- Achievements are deduplicated and ranked by impact
- Maximum of 10 achievements returned, fewer if insufficient quality achievements exist</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>text</code>
</td>
<td>
<code><span title="typing.Annotated">Annotated</span>[<span title="str">str</span>, <span title="pydantic.Field">Field</span>(min_length=1)]</code>
</td>
<td>
<div class="doc-md-description">
<p>The employee self-review text to analyze. Must be non-empty string
containing the review content from which to extract achievements.
Typically contains mixed content (tasks, outcomes, anecdotes) that
needs to be parsed for concrete accomplishments.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>AchievementsList</code></td> <td>
<code><span title="metamorphosis.datamodel.AchievementsList">AchievementsList</span></code>
</td>
<td>
<div class="doc-md-description">
<p>A structured response containing:
- items: List of up to 10 Achievement objects ranked by impact
- size: Token estimate of concatenated titles and outcomes
- unit: Always "tokens"</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.ValidationError">ValidationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the input text is empty or invalid.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.PostconditionError">PostconditionError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the LLM output validation fails or the structured
response cannot be parsed correctly.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="ConfigurationError">ConfigurationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the key achievements LLM is not properly configured.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<blockquote>
<blockquote>
<blockquote>
<p>modifier = TextModifiers()
result = modifier.extract_achievements(
...     text="I reduced checkout p95 latency from 480ms to 190ms in H1 2025 "
...          "by redesigning the caching layer with the Payments and SRE teams. "
...          "This improved conversion rates during peak traffic periods."
... )
print(result.items[0].title)
"Cut checkout p95 latency"
print(result.items[0].impact_area)
"performance"
print(result.items[0].metric_strings)
["480ms", "190ms"]</p>
</blockquote>
</blockquote>
</blockquote>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>This method uses the key_achievements_system_prompt.md and
key_achievements_user_prompt.md templates to guide the LLM's behavior.
The extraction is performed by the key_achievements_llm configured
in the model registry.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_achievements</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AchievementsList</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Extract key achievements from employee self-review text.</span>

<span class="sd">    This method analyzes employee self-review text and extracts up to 10 key achievements</span>
<span class="sd">    with structured metadata including impact areas, metrics, timeframes, and</span>
<span class="sd">    collaboration details. The extraction focuses on identifying concrete outcomes</span>
<span class="sd">    and business impact rather than activities or tasks.</span>

<span class="sd">    The method uses an LLM-based achievement extractor that follows strict guidelines</span>
<span class="sd">    to identify and rank achievements by:</span>
<span class="sd">    - Business/customer impact (revenue, cost, risk, user outcomes)</span>
<span class="sd">    - Reliability/quality/security improvements (SLO/MTTR/incidents/defects)</span>
<span class="sd">    - Breadth of ownership (Cross-team/Org-wide &gt; TechLead &gt; IC)</span>
<span class="sd">    - Adoption/usage and external validation</span>
<span class="sd">    - Recency (tie-breaker)</span>

<span class="sd">    **Achievement Structure:**</span>
<span class="sd">    Each extracted achievement includes:</span>
<span class="sd">    - **title**: Concise, outcome-oriented label (≤12 words)</span>
<span class="sd">    - **outcome**: Impact/result description (≤40 words)</span>
<span class="sd">    - **impact_area**: Categorized impact type (reliability, performance, security, etc.)</span>
<span class="sd">    - **metric_strings**: Verbatim numbers/units from the review text</span>
<span class="sd">    - **timeframe**: Explicit time period if stated (e.g., "Q2 2025", "H1")</span>
<span class="sd">    - **ownership_scope**: Leadership level if explicit (IC, TechLead, Manager, etc.)</span>
<span class="sd">    - **collaborators**: Named people/teams if mentioned</span>

<span class="sd">    **Quality Guarantees:**</span>
<span class="sd">    - No invented metrics, dates, or collaborators - only explicit information</span>
<span class="sd">    - Numbers and units copied exactly as they appear in the review</span>
<span class="sd">    - Achievements are deduplicated and ranked by impact</span>
<span class="sd">    - Maximum of 10 achievements returned, fewer if insufficient quality achievements exist</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The employee self-review text to analyze. Must be non-empty string</span>
<span class="sd">            containing the review content from which to extract achievements.</span>
<span class="sd">            Typically contains mixed content (tasks, outcomes, anecdotes) that</span>
<span class="sd">            needs to be parsed for concrete accomplishments.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AchievementsList: A structured response containing:</span>
<span class="sd">            - items: List of up to 10 Achievement objects ranked by impact</span>
<span class="sd">            - size: Token estimate of concatenated titles and outcomes</span>
<span class="sd">            - unit: Always "tokens"</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If the input text is empty or invalid.</span>
<span class="sd">        PostconditionError: If the LLM output validation fails or the structured</span>
<span class="sd">            response cannot be parsed correctly.</span>
<span class="sd">        ConfigurationError: If the key achievements LLM is not properly configured.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; modifier = TextModifiers()</span>
<span class="sd">        &gt;&gt;&gt; result = modifier.extract_achievements(</span>
<span class="sd">        ...     text="I reduced checkout p95 latency from 480ms to 190ms in H1 2025 "</span>
<span class="sd">        ...          "by redesigning the caching layer with the Payments and SRE teams. "</span>
<span class="sd">        ...          "This improved conversion rates during peak traffic periods."</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(result.items[0].title)</span>
<span class="sd">        "Cut checkout p95 latency"</span>
<span class="sd">        &gt;&gt;&gt; print(result.items[0].impact_area)</span>
<span class="sd">        "performance"</span>
<span class="sd">        &gt;&gt;&gt; print(result.items[0].metric_strings)</span>
<span class="sd">        ["480ms", "190ms"]</span>

<span class="sd">    Note:</span>
<span class="sd">        This method uses the key_achievements_system_prompt.md and</span>
<span class="sd">        key_achievements_user_prompt.md templates to guide the LLM's behavior.</span>
<span class="sd">        The extraction is performed by the key_achievements_llm configured</span>
<span class="sd">        in the model registry.</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"extract_achievements: processing text (length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"extract_achievements"</span><span class="p">)</span>

    <span class="c1"># Construct the prompt using the key achievements templates</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_system_prompt</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">EMPLOYEE_REVIEW_TEXT</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="c1"># Create the achievement extraction chain with structured output</span>
    <span class="n">extractor</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">AchievementsList</span><span class="p">)</span>

    <span class="c1"># Invoke the chain with exception handling</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">extractor</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"extract_achievements: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
            <span class="s2">"Achievement extraction LLM invocation failed"</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"extract_achievements_llm_invocation"</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">AchievementsList</span><span class="p">):</span>
        <span class="n">raise_postcondition_error</span><span class="p">(</span>
            <span class="s2">"Achievement extraction output validation failed"</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">"has_items"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"items"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="p">},</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"extract_achievements_validation"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">"extract_achievements: completed successfully (items_count=</span><span class="si">{}</span><span class="s2">, total_size=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
        <span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="metamorphosis.mcp.text_modifiers.TextModifiers.get_model_info">
<code class="highlight language-python"><span class="n">get_model_info</span><span class="p">(</span><span class="n">method</span><span class="p">)</span></code>
<a class="headerlink" href="#metamorphosis.mcp.text_modifiers.TextModifiers.get_model_info" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Get model configuration information for a specific method.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>method</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>The method name (e.g., "summarize", "rationalize_text", 
"extract_achievements", "evaluate_review_text").</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
</td>
<td>
<div class="doc-md-description">
<p>Dictionary containing model configuration or None if not found.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Get model configuration information for a specific method.</span>

<span class="sd">    Args:</span>
<span class="sd">        method: The method name (e.g., "summarize", "rationalize_text", </span>
<span class="sd">            "extract_achievements", "evaluate_review_text").</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dictionary containing model configuration or None if not found.</span>
<span class="sd">    """</span>
    <span class="n">method_to_llm</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"summarize"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span><span class="p">,</span>
        <span class="s2">"rationalize_text"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_editor_llm</span><span class="p">,</span>
        <span class="s2">"extract_achievements"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_achievements_llm</span><span class="p">,</span>
        <span class="s2">"evaluate_review_text"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">review_text_evaluator_llm</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">llm</span> <span class="o">=</span> <span class="n">method_to_llm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">llm</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Extract configuration from the LLM instance</span>
    <span class="n">model_info</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"model"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"model_name"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
        <span class="s2">"temperature"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"temperature"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
        <span class="s2">"max_tokens"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"max_tokens"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
        <span class="s2">"timeout"</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="s2">"request_timeout"</span><span class="p">,</span> <span class="s2">"N/A"</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Add optional parameters if they exist</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">"top_p"</span><span class="p">,</span> <span class="s2">"frequency_penalty"</span><span class="p">,</span> <span class="s2">"presence_penalty"</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">llm</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_info</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">model_info</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="metamorphosis.mcp.text_modifiers.TextModifiers.rationalize_text">
<code class="highlight language-python"><span class="n">rationalize_text</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span></code>
<a class="headerlink" href="#metamorphosis.mcp.text_modifiers.TextModifiers.rationalize_text" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Rationalize text by correcting grammar, spelling, and formatting errors.</p>
<p>This method performs text rationalization using an LLM-based copy editor that makes
minor, localized corrections to improve the professional quality of text while
preserving the original meaning, structure, and content. The rationalization process
focuses on fixing:</p>
<ul>
<li>Spelling errors and typos (e.g., "teh" → "the", "recieved" → "received")</li>
<li>Grammar issues (subject-verb agreement, tense consistency, articles)</li>
<li>Punctuation normalization (quotes, commas, dashes, parentheses)</li>
<li>Capitalization consistency (proper nouns, product names, teams)</li>
<li>Whitespace and formatting standardization</li>
<li>Casual shorthand replacement with formal equivalents (e.g., "w/" → "with")</li>
</ul>
<p>The method is specifically designed for employee self-reviews and similar business
documents that may contain informal language, typos, or inconsistent formatting
from being pasted from drafts or messaging platforms.</p>
<p><strong>Preservation Guarantees:</strong>
- Original paragraph structure and ordering are maintained exactly
- Numerical values and units remain identical (only formatting may be normalized)
- Bullet points, headings, and section order are preserved
- Author's voice and intent (first/third person) are retained
- No content is added, removed, or significantly rewritten</p>
<p><strong>Style Transformations:</strong>
- Converts informal shorthand to professional language when unambiguous
- Normalizes product/tool names for consistency
- Standardizes punctuation and spacing around units and symbols
- Removes casual interjections while preserving meaning
- Corrects double negatives in reduction statements (e.g., "reduced by -38%" → "reduced by 38%")  # noqa: E501</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>text</code>
</td>
<td>
<code><span title="typing.Annotated">Annotated</span>[<span title="str">str</span>, <span title="pydantic.Field">Field</span>(min_length=1)]</code>
</td>
<td>
<div class="doc-md-description">
<p>The input text to rationalize. Must be non-empty string containing
the content to be copy-edited. Typically employee self-review text
or similar business documents that need professional polish.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>CopyEditedText</code></td> <td>
<code><a class="autorefs autorefs-internal" href="../../datamodel/#metamorphosis.datamodel.CopyEditedText" title="CopyEditedText (metamorphosis.datamodel.CopyEditedText)">CopyEditedText</a></code>
</td>
<td>
<div class="doc-md-description">
<p>A structured response containing:
- copy_edited_text: The rationalized text with corrections applied
- size: Estimated token count of the rationalized text
- is_edited: Boolean indicating whether any changes were made</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.ValidationError">ValidationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the input text is empty or invalid.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.PostconditionError">PostconditionError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the LLM output validation fails or the structured
response cannot be parsed correctly.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="ConfigurationError">ConfigurationError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the copy editor LLM is not properly configured.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="example" open="">
<summary>Example</summary>
<blockquote>
<blockquote>
<blockquote>
<p>modifier = TextModifiers()
result = modifier.rationalize_text(
...     text="I migrated teh system w/ better performance. "
...          "Latency dropped by -38% after optimizations."
... )
print(result.copy_edited_text)
"I migrated the system with better performance. "
"Latency dropped by 38% after optimizations."
print(result.is_edited)
True</p>
</blockquote>
</blockquote>
</blockquote>
</details>
<details class="note" open="">
<summary>Note</summary>
<p>This method uses the text_rationalization_system_prompt.md and
text_rationalization_user_prompt.md templates to guide the LLM's
behavior. The rationalization is performed by the copy_editor_llm
configured in the model registry.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rationalize_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="n">CopyEditedText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Rationalize text by correcting grammar, spelling, and formatting errors.</span>

<span class="sd">    This method performs text rationalization using an LLM-based copy editor that makes</span>
<span class="sd">    minor, localized corrections to improve the professional quality of text while</span>
<span class="sd">    preserving the original meaning, structure, and content. The rationalization process</span>
<span class="sd">    focuses on fixing:</span>

<span class="sd">    - Spelling errors and typos (e.g., "teh" → "the", "recieved" → "received")</span>
<span class="sd">    - Grammar issues (subject-verb agreement, tense consistency, articles)</span>
<span class="sd">    - Punctuation normalization (quotes, commas, dashes, parentheses)</span>
<span class="sd">    - Capitalization consistency (proper nouns, product names, teams)</span>
<span class="sd">    - Whitespace and formatting standardization</span>
<span class="sd">    - Casual shorthand replacement with formal equivalents (e.g., "w/" → "with")</span>

<span class="sd">    The method is specifically designed for employee self-reviews and similar business</span>
<span class="sd">    documents that may contain informal language, typos, or inconsistent formatting</span>
<span class="sd">    from being pasted from drafts or messaging platforms.</span>

<span class="sd">    **Preservation Guarantees:**</span>
<span class="sd">    - Original paragraph structure and ordering are maintained exactly</span>
<span class="sd">    - Numerical values and units remain identical (only formatting may be normalized)</span>
<span class="sd">    - Bullet points, headings, and section order are preserved</span>
<span class="sd">    - Author's voice and intent (first/third person) are retained</span>
<span class="sd">    - No content is added, removed, or significantly rewritten</span>

<span class="sd">    **Style Transformations:**</span>
<span class="sd">    - Converts informal shorthand to professional language when unambiguous</span>
<span class="sd">    - Normalizes product/tool names for consistency</span>
<span class="sd">    - Standardizes punctuation and spacing around units and symbols</span>
<span class="sd">    - Removes casual interjections while preserving meaning</span>
<span class="sd">    - Corrects double negatives in reduction statements (e.g., "reduced by -38%" → "reduced by 38%")  # noqa: E501</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The input text to rationalize. Must be non-empty string containing</span>
<span class="sd">            the content to be copy-edited. Typically employee self-review text</span>
<span class="sd">            or similar business documents that need professional polish.</span>

<span class="sd">    Returns:</span>
<span class="sd">        CopyEditedText: A structured response containing:</span>
<span class="sd">            - copy_edited_text: The rationalized text with corrections applied</span>
<span class="sd">            - size: Estimated token count of the rationalized text</span>
<span class="sd">            - is_edited: Boolean indicating whether any changes were made</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValidationError: If the input text is empty or invalid.</span>
<span class="sd">        PostconditionError: If the LLM output validation fails or the structured</span>
<span class="sd">            response cannot be parsed correctly.</span>
<span class="sd">        ConfigurationError: If the copy editor LLM is not properly configured.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; modifier = TextModifiers()</span>
<span class="sd">        &gt;&gt;&gt; result = modifier.rationalize_text(</span>
<span class="sd">        ...     text="I migrated teh system w/ better performance. "</span>
<span class="sd">        ...          "Latency dropped by -38% after optimizations."</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; print(result.copy_edited_text)</span>
<span class="sd">        "I migrated the system with better performance. "</span>
<span class="sd">        "Latency dropped by 38% after optimizations."</span>
<span class="sd">        &gt;&gt;&gt; print(result.is_edited)</span>
<span class="sd">        True</span>

<span class="sd">    Note:</span>
<span class="sd">        This method uses the text_rationalization_system_prompt.md and</span>
<span class="sd">        text_rationalization_user_prompt.md templates to guide the LLM's</span>
<span class="sd">        behavior. The rationalization is performed by the copy_editor_llm</span>
<span class="sd">        configured in the model registry.</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"rationalize_text: processing text (length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
    <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"rationalize_text"</span><span class="p">)</span>

    <span class="c1"># Construct the prompt using the text rationalization templates</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_system_prompt</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">text_rationalization_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">EMPLOYEE_REVIEW_TEXT</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>

    <span class="c1"># Create the rationalization chain with structured output</span>
    <span class="n">rationalizer</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy_editor_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">CopyEditedText</span><span class="p">)</span>

    <span class="c1"># Invoke the chain with exception handling</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">rationalizer</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"rationalize_text: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
            <span class="s2">"Text rationalization LLM invocation failed"</span><span class="p">,</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"rationalize_text_llm_invocation"</span><span class="p">,</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">CopyEditedText</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">copy_edited_text</span><span class="p">:</span>
        <span class="n">raise_postcondition_error</span><span class="p">(</span>
            <span class="s2">"Text rationalization output validation failed"</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">"has_text"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"copy_edited_text"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="p">},</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"rationalize_text_validation"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">"rationalize_text: completed successfully (output_length=</span><span class="si">{}</span><span class="s2">, edited=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span>
        <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">copy_edited_text</span><span class="p">),</span>
        <span class="n">result</span><span class="o">.</span><span class="n">is_edited</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="metamorphosis.mcp.text_modifiers.TextModifiers.summarize">
<code class="highlight language-python"><span class="n">summarize</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span></code>
<a class="headerlink" href="#metamorphosis.mcp.text_modifiers.TextModifiers.summarize" title="Permanent link">¶</a></h2>
<div class="doc doc-contents">
<p>Summarize text using the configured LLM chain.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>text</code>
</td>
<td>
<code><span title="typing.Annotated">Annotated</span>[<span title="str">str</span>, <span title="pydantic.Field">Field</span>(min_length=1)]</code>
</td>
<td>
<div class="doc-md-description">
<p>The input text to summarize.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>max_words</code>
</td>
<td>
<code><span title="typing.Annotated">Annotated</span>[<span title="int">int</span>, <span title="pydantic.Field">Field</span>(gt=0)]</code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of words in the summary.</p>
</div>
</td>
<td>
<code>300</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Name</th> <th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td><code>SummarizedText</code></td> <td>
<code><a class="autorefs autorefs-internal" href="../../datamodel/#metamorphosis.datamodel.SummarizedText" title="SummarizedText (metamorphosis.datamodel.SummarizedText)">SummarizedText</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Structured summary with the summarized text.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="metamorphosis.exceptions.PostconditionError">PostconditionError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If the output validation fails.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/metamorphosis/mcp/text_modifiers.py</code></summary>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
    <span class="n">max_words</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizedText</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Summarize text using the configured LLM chain.</span>

<span class="sd">    Args:</span>
<span class="sd">        text: The input text to summarize.</span>
<span class="sd">        max_words: Maximum number of words in the summary.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SummarizedText: Structured summary with the summarized text.</span>

<span class="sd">    Raises:</span>
<span class="sd">        PostconditionError: If the output validation fails.</span>
<span class="sd">    """</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"summarize: processing text (length=</span><span class="si">{}</span><span class="s2">, max_words=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">max_words</span><span class="p">)</span>
    <span class="c1"># Log the model details as a simple table for traceability and debugging.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_model_details_table</span><span class="p">(</span><span class="s2">"summarize"</span><span class="p">)</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_system_prompt</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">review</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
    <span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="o">.</span><span class="n">from_messages</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">"summarizer_llm: </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span><span class="p">)</span>
    <span class="n">summarizer</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_llm</span><span class="o">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">SummarizedText</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">summarizer</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"summarize: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
            <span class="s2">"Summarization LLM invocation failed"</span><span class="p">,</span> <span class="n">operation</span><span class="o">=</span><span class="s2">"summarize_llm_invocation"</span>
        <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>

    <span class="c1"># Postcondition (O(1)): ensure structured output is valid</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SummarizedText</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span><span class="p">:</span>
        <span class="n">raise_postcondition_error</span><span class="p">(</span>
            <span class="s2">"Summarization output validation failed"</span><span class="p">,</span>
            <span class="n">context</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">"has_text"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">"summarized_text"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)),</span>
            <span class="p">},</span>
            <span class="n">operation</span><span class="o">=</span><span class="s2">"summarize_validation"</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="s2">"summarize: completed successfully (output_length=</span><span class="si">{}</span><span class="s2">)"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
</details>
</div>
</div>
</div>
</div>
</div><h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>The <code>TextModifiers</code> class is the core component of the MCP package, providing comprehensive LLM-backed text processing utilities. It implements four main capabilities: summarization, copy editing (text rationalization), achievement extraction, and review quality evaluation.</p>
<h2 id="class-architecture">Class Architecture<a class="headerlink" href="#class-architecture" title="Permanent link">¶</a></h2>
<div class="mermaid">classDiagram
    class TextModifiers {
        -summarizer_llm: ChatOpenAI
        -copy_editor_llm: ChatOpenAI
        -key_achievements_llm: ChatOpenAI
        -review_text_evaluator_llm: ChatOpenAI
        -summarizer_system_prompt: str
        -summarizer_user_prompt: str
        -text_rationalization_system_prompt: str
        -text_rationalization_user_prompt: str
        -key_achievements_system_prompt: str
        -key_achievements_user_prompt: str
        -text_evaluator_system_prompt: str
        -text_evaluator_user_prompt: str
        +__init__()
        +summarize(text, max_words) SummarizedText
        +rationalize_text(text) CopyEditedText
        +extract_achievements(text) AchievementsList
        +evaluate_review_text(text) ReviewScorecard
        +get_model_info(method) dict
        -_log_model_details_table(method)
    }

    class ModelRegistry {
        +summarizer_llm: ChatOpenAI
        +copy_editor_llm: ChatOpenAI
        +key_achievements_llm: ChatOpenAI
        +review_text_evaluator_llm: ChatOpenAI
    }

    class SummarizedText {
        +summarized_text: str
        +size: int
        +unit: str
    }

    class CopyEditedText {
        +copy_edited_text: str
        +size: int
        +is_edited: bool
    }

    class AchievementsList {
        +items: List[Achievement]
        +size: int
        +unit: str
    }

    class ReviewScorecard {
        +metrics: List[MetricScore]
        +overall: int
        +verdict: Verdict
        +notes: List[str]
        +radar_labels: List[str]
        +radar_values: List[int]
    }

    TextModifiers --&gt; ModelRegistry : uses
    TextModifiers --&gt; SummarizedText : creates
    TextModifiers --&gt; CopyEditedText : creates
    TextModifiers --&gt; AchievementsList : creates
    TextModifiers --&gt; ReviewScorecard : creates
</div>
<h2 id="initialization">Initialization<a class="headerlink" href="#initialization" title="Permanent link">¶</a></h2>
<h3 id="constructor">Constructor<a class="headerlink" href="#constructor" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Initialize the TextModifiers with LLM chains and prompt templates."""</span>
</code></pre></div>
<p>The constructor performs several key initialization steps:</p>
<ol>
<li><strong>LLM Client Acquisition</strong>: Retrieves configured LLM clients from the ModelRegistry</li>
<li><strong>Prompt Template Loading</strong>: Loads external prompt templates from the <code>prompts/</code> directory</li>
<li><strong>Validation</strong>: Ensures all required components are properly initialized</li>
</ol>
<h4 id="llm-clients">LLM Clients<a class="headerlink" href="#llm-clients" title="Permanent link">¶</a></h4>
<p>The class initializes four specialized LLM clients:</p>
<ul>
<li><strong><code>summarizer_llm</code></strong>: For text summarization (default: gpt-4o)</li>
<li><strong><code>copy_editor_llm</code></strong>: For text rationalization (default: gpt-4o)</li>
<li><strong><code>key_achievements_llm</code></strong>: For achievement extraction (default: gpt-4o)</li>
<li><strong><code>review_text_evaluator_llm</code></strong>: For quality evaluation (default: gpt-5)</li>
</ul>
<h4 id="prompt-templates">Prompt Templates<a class="headerlink" href="#prompt-templates" title="Permanent link">¶</a></h4>
<p>Prompt templates are loaded from external Markdown files for maintainability:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># System and user prompts for each capability</span>
<span class="bp">self</span><span class="o">.</span><span class="n">summarizer_system_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span><span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"summarizer_system_prompt.md"</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">summarizer_user_prompt</span> <span class="o">=</span> <span class="n">read_text_file</span><span class="p">(</span><span class="n">prompts_dir</span> <span class="o">/</span> <span class="s2">"summarizer_user_prompt.md"</span><span class="p">)</span>
<span class="c1"># ... (similar for other capabilities)</span>
</code></pre></div>
<h2 id="core-methods">Core Methods<a class="headerlink" href="#core-methods" title="Permanent link">¶</a></h2>
<h3 id="1-text-summarization">1. Text Summarization<a class="headerlink" href="#1-text-summarization" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>
    <span class="n">max_words</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizedText</span><span class="p">:</span>
</code></pre></div>
<p><strong>Purpose</strong>: Generate abstractive summaries of employee review text.</p>
<p><strong>Features</strong>:
- Configurable word limits (default: 300 words)
- Preserves key information and context
- Structured output with metadata
- Token estimation for billing/monitoring</p>
<p><strong>Example Usage</strong>:
<div class="highlight"><pre><span></span><code><span class="n">modifier</span> <span class="o">=</span> <span class="n">TextModifiers</span><span class="p">()</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">"Long employee review discussing multiple projects and achievements..."</span><span class="p">,</span>
    <span class="n">max_words</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Summary: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Token estimate: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">unit</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></p>
<p><strong>Processing Flow</strong>:
1. Input validation using Pydantic decorators
2. Model details logging for traceability
3. LLM invocation with structured output parsing
4. Post-condition validation
5. Result packaging in <code>SummarizedText</code> model</p>
<h3 id="2-text-rationalization-copy-editing">2. Text Rationalization (Copy Editing)<a class="headerlink" href="#2-text-rationalization-copy-editing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rationalize_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)])</span> <span class="o">-&gt;</span> <span class="n">CopyEditedText</span><span class="p">:</span>
</code></pre></div>
<p><strong>Purpose</strong>: Improve grammar, spelling, and professional tone while preserving meaning.</p>
<p><strong>Key Features</strong>:
- <strong>Grammar &amp; Spelling</strong>: Fixes errors and typos
- <strong>Professional Tone</strong>: Converts informal language to professional style
- <strong>Structure Preservation</strong>: Maintains original paragraph structure
- <strong>Content Integrity</strong>: No addition or removal of factual content
- <strong>Voice Preservation</strong>: Retains author's perspective (first/third person)</p>
<p><strong>Transformation Examples</strong>:
- <code>"teh system"</code> → <code>"the system"</code>
- <code>"w/ better performance"</code> → <code>"with better performance"</code>
- <code>"reduced by -38%"</code> → <code>"reduced by 38%"</code></p>
<p><strong>Example Usage</strong>:
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">rationalize_text</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">"I migrated teh system w/ better performance. Latency dropped by -38%."</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Edited: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">copy_edited_text</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Was modified: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">is_edited</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="3-achievement-extraction">3. Achievement Extraction<a class="headerlink" href="#3-achievement-extraction" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">extract_achievements</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AchievementsList</span><span class="p">:</span>
</code></pre></div>
<p><strong>Purpose</strong>: Extract and structure key accomplishments from employee reviews.</p>
<p><strong>Key Features</strong>:
- <strong>Ranking</strong>: Achievements ranked by business impact
- <strong>Structured Metadata</strong>: Impact areas, metrics, timeframes, collaborators
- <strong>Quality Filtering</strong>: Only defensible achievements included
- <strong>Limit</strong>: Up to 10 achievements (configurable in prompt)</p>
<p><strong>Achievement Structure</strong>:
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Achievement</span><span class="p">:</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Concise outcome-oriented label (≤12 words)</span>
    <span class="n">outcome</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Impact/result description (≤40 words)</span>
    <span class="n">impact_area</span><span class="p">:</span> <span class="n">ImpactArea</span>  <span class="c1"># Categorized impact type</span>
    <span class="n">metric_strings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Verbatim numbers from text</span>
    <span class="n">timeframe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Explicit time period if stated</span>
    <span class="n">ownership_scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OwnershipScope</span><span class="p">]</span>  <span class="c1"># Leadership level</span>
    <span class="n">collaborators</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="c1"># Named people/teams</span>
</code></pre></div></p>
<p><strong>Example Usage</strong>:
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">extract_achievements</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">"I reduced checkout p95 latency from 480ms to 190ms in H1 2025 by redesigning the caching layer with the Payments and SRE teams."</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">achievement</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Title: </span><span class="si">{</span><span class="n">achievement</span><span class="o">.</span><span class="n">title</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Impact Area: </span><span class="si">{</span><span class="n">achievement</span><span class="o">.</span><span class="n">impact_area</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Metrics: </span><span class="si">{</span><span class="n">achievement</span><span class="o">.</span><span class="n">metric_strings</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Timeframe: </span><span class="si">{</span><span class="n">achievement</span><span class="o">.</span><span class="n">timeframe</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Collaborators: </span><span class="si">{</span><span class="n">achievement</span><span class="o">.</span><span class="n">collaborators</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="4-review-quality-evaluation">4. Review Quality Evaluation<a class="headerlink" href="#4-review-quality-evaluation" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_review_text</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReviewScorecard</span><span class="p">:</span>
</code></pre></div>
<p><strong>Purpose</strong>: Assess writing quality across six key dimensions.</p>
<p><strong>Evaluation Dimensions</strong> (with weights):
1. <strong>OutcomeOverActivity</strong> (25%): Emphasis on concrete outcomes vs. task lists
2. <strong>QuantitativeSpecificity</strong> (25%): Use of metrics, numbers, and baselines
3. <strong>ClarityCoherence</strong> (15%): Logical flow and readability
4. <strong>Conciseness</strong> (15%): Efficient, non-redundant expression
5. <strong>OwnershipLeadership</strong> (10%): Clear ownership and leadership signals
6. <strong>Collaboration</strong> (10%): Evidence of cross-team work</p>
<p><strong>Scoring System</strong>:
- Each dimension scored 0-100 using anchor levels (20/40/60/80/95)
- Overall score is weighted average
- Verdict classification: excellent (≥85), strong (70-84), mixed (50-69), weak (&lt;50)</p>
<p><strong>Example Usage</strong>:
<div class="highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">evaluate_review_text</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">"I reduced latency from 480ms to 190ms by optimizing the cache. This improved user experience and reduced server costs by 15%."</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Overall Score: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">overall</span><span class="si">}</span><span class="s2">/100"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Verdict: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">verdict</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">/100"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Rationale: </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">rationale</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Suggestion: </span><span class="si">{</span><span class="n">metric</span><span class="o">.</span><span class="n">suggestion</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="utility-methods">Utility Methods<a class="headerlink" href="#utility-methods" title="Permanent link">¶</a></h2>
<h3 id="model-information-introspection">Model Information Introspection<a class="headerlink" href="#model-information-introspection" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_model_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</code></pre></div>
<p><strong>Purpose</strong>: Retrieve model configuration for debugging and monitoring.</p>
<p><strong>Parameters</strong>:
- <code>method</code>: The method name ("summarize", "rationalize_text", "extract_achievements", "evaluate_review_text")</p>
<p><strong>Returns</strong>: Dictionary containing model configuration or None if method not found.</p>
<p><strong>Example Usage</strong>:
<div class="highlight"><pre><span></span><code><span class="n">info</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">get_model_info</span><span class="p">(</span><span class="s2">"summarize"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Model: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'model'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Temperature: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'temperature'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Max Tokens: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'max_tokens'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Timeout: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s1">'timeout'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div></p>
<h3 id="model-details-logging">Model Details Logging<a class="headerlink" href="#model-details-logging" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_log_model_details_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</code></pre></div>
<p><strong>Purpose</strong>: Log LLM model details in a formatted table for traceability.</p>
<p>This private method is automatically called by all processing methods to provide detailed logging of the model configuration being used. This is crucial for debugging and monitoring in production environments.</p>
<p><strong>Example Log Output</strong>:
<div class="highlight"><pre><span></span><code>LLM Model Details for 'summarize':
Parameter       | Value
----------------|--------------------
Model           | gpt-4o
Temperature     | 0.0
Max Tokens      | 2000
Timeout         | 120
</code></pre></div></p>
<h2 id="design-patterns">Design Patterns<a class="headerlink" href="#design-patterns" title="Permanent link">¶</a></h2>
<h3 id="validation-first-design">Validation-First Design<a class="headerlink" href="#validation-first-design" title="Permanent link">¶</a></h3>
<p>All public methods use Pydantic's <code>@validate_call</code> decorator for automatic input validation:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@validate_call</span>
<span class="k">def</span><span class="w"> </span><span class="nf">summarize</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>  <span class="c1"># Keyword-only arguments for clarity</span>
    <span class="n">text</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)],</span>  <span class="c1"># Must be non-empty</span>
    <span class="n">max_words</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>  <span class="c1"># Must be positive</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SummarizedText</span><span class="p">:</span>
</code></pre></div>
<h3 id="fail-fast-error-handling">Fail-Fast Error Handling<a class="headerlink" href="#fail-fast-error-handling" title="Permanent link">¶</a></h3>
<p>The class implements comprehensive error handling with specific exception types:</p>
<div class="highlight"><pre><span></span><code><span class="k">try</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">summarizer</span><span class="o">.</span><span class="n">invoke</span><span class="p">({})</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"summarize: LLM invocation failed - </span><span class="si">{}</span><span class="s2">"</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
    <span class="k">raise</span> <span class="n">PostconditionError</span><span class="p">(</span>
        <span class="s2">"Summarization LLM invocation failed"</span><span class="p">,</span>
        <span class="n">operation</span><span class="o">=</span><span class="s2">"summarize_llm_invocation"</span>
    <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div>
<h3 id="structured-output-pattern">Structured Output Pattern<a class="headerlink" href="#structured-output-pattern" title="Permanent link">¶</a></h3>
<p>All methods return strongly-typed Pydantic models for type safety:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Instead of returning raw strings or dictionaries</span>
<span class="k">return</span> <span class="n">SummarizedText</span><span class="p">(</span>
    <span class="n">summarized_text</span><span class="o">=</span><span class="n">processed_text</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="n">token_estimate</span><span class="p">,</span>
    <span class="n">unit</span><span class="o">=</span><span class="s2">"tokens"</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="template-driven-prompting">Template-Driven Prompting<a class="headerlink" href="#template-driven-prompting" title="Permanent link">¶</a></h3>
<p>Prompt templates are externalized for maintainability and version control:</p>
<div class="highlight"><pre><span></span><code><span class="n">messages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">"system"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_system_prompt</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">"user"</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">summarizer_user_prompt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">review</span><span class="o">=</span><span class="n">text</span><span class="p">)),</span>
<span class="p">]</span>
</code></pre></div>
<h2 id="error-handling">Error Handling<a class="headerlink" href="#error-handling" title="Permanent link">¶</a></h2>
<h3 id="exception-hierarchy">Exception Hierarchy<a class="headerlink" href="#exception-hierarchy" title="Permanent link">¶</a></h3>
<p>The class raises specific exceptions for different error conditions:</p>
<ul>
<li><strong><code>ValidationError</code></strong>: Invalid input parameters</li>
<li><strong><code>PostconditionError</code></strong>: LLM invocation or output validation failures</li>
<li><strong><code>ConfigurationError</code></strong>: Missing or invalid configuration</li>
<li><strong><code>FileOperationError</code></strong>: Prompt template loading issues</li>
</ul>
<h3 id="error-context">Error Context<a class="headerlink" href="#error-context" title="Permanent link">¶</a></h3>
<p>All exceptions include rich context for debugging:</p>
<div class="highlight"><pre><span></span><code><span class="n">raise_postcondition_error</span><span class="p">(</span>
    <span class="s2">"Summarization output validation failed"</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"result_type"</span><span class="p">:</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
        <span class="s2">"has_text"</span><span class="p">:</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s1">'summarized_text'</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
    <span class="p">},</span>
    <span class="n">operation</span><span class="o">=</span><span class="s2">"summarize_validation"</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="performance-considerations">Performance Considerations<a class="headerlink" href="#performance-considerations" title="Permanent link">¶</a></h2>
<h3 id="llm-client-reuse">LLM Client Reuse<a class="headerlink" href="#llm-client-reuse" title="Permanent link">¶</a></h3>
<p>LLM clients are initialized once and reused across all method calls, avoiding expensive re-initialization.</p>
<h3 id="prompt-template-caching">Prompt Template Caching<a class="headerlink" href="#prompt-template-caching" title="Permanent link">¶</a></h3>
<p>Prompt templates are loaded once during initialization and cached in memory.</p>
<h3 id="token-optimization">Token Optimization<a class="headerlink" href="#token-optimization" title="Permanent link">¶</a></h3>
<ul>
<li>Efficient prompt design minimizes token usage</li>
<li>Structured output reduces parsing overhead</li>
<li>Streaming support for real-time applications</li>
</ul>
<h3 id="memory-management">Memory Management<a class="headerlink" href="#memory-management" title="Permanent link">¶</a></h3>
<ul>
<li>Large text inputs are processed efficiently</li>
<li>Results include size estimates for monitoring</li>
<li>Proper cleanup of temporary objects</li>
</ul>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">¶</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metamorphosis.mcp.text_modifiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextModifiers</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metamorphosis.datamodel</span><span class="w"> </span><span class="kn">import</span> <span class="n">SummarizedText</span><span class="p">,</span> <span class="n">CopyEditedText</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestTextModifiers</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span> <span class="o">=</span> <span class="n">TextModifiers</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_summarization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">"Long employee review text..."</span><span class="p">,</span>
            <span class="n">max_words</span><span class="o">=</span><span class="mi">50</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">SummarizedText</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_copy_editing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span><span class="o">.</span><span class="n">rationalize_text</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">"Text with errers and typos."</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">CopyEditedText</span><span class="p">)</span>
        <span class="k">assert</span> <span class="s2">"errors"</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">copy_edited_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_edited</span> <span class="ow">is</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">test_model_info_retrieval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modifier</span><span class="o">.</span><span class="n">get_model_info</span><span class="p">(</span><span class="s2">"summarize"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="s2">"model"</span> <span class="ow">in</span> <span class="n">info</span>
        <span class="k">assert</span> <span class="s2">"temperature"</span> <span class="ow">in</span> <span class="n">info</span>
</code></pre></div>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_end_to_end_processing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">modifier</span> <span class="o">=</span> <span class="n">TextModifiers</span><span class="p">()</span>

    <span class="c1"># Test full pipeline</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s2">"I led a project that improved system performance by 40%..."</span>

    <span class="n">summary</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">max_words</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">edited</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">rationalize_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
    <span class="n">achievements</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">extract_achievements</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
    <span class="n">evaluation</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">evaluate_review_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">summary</span><span class="p">,</span> <span class="n">edited</span><span class="p">,</span> <span class="n">achievements</span><span class="p">,</span> <span class="n">evaluation</span><span class="p">])</span>
</code></pre></div>
<h2 id="migration-guide">Migration Guide<a class="headerlink" href="#migration-guide" title="Permanent link">¶</a></h2>
<h3 id="from-v0x-to-v10">From v0.x to v1.0<a class="headerlink" href="#from-v0x-to-v10" title="Permanent link">¶</a></h3>
<ol>
<li>
<p><strong>Update Imports</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Old</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metamorphosis.text_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextProcessor</span>

<span class="c1"># New</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metamorphosis.mcp.text_modifiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">TextModifiers</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Update Method Names</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Old</span>
<span class="n">processor</span><span class="o">.</span><span class="n">copy_edit</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

<span class="c1"># New</span>
<span class="n">modifier</span><span class="o">.</span><span class="n">rationalize_text</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Update Return Types</strong>:
   <div class="highlight"><pre><span></span><code><span class="c1"># Old - returned plain strings/dicts</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">processor</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="n">summary_text</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">"summary"</span><span class="p">]</span>

<span class="c1"># New - returns Pydantic models</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">modifier</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">)</span>
<span class="n">summary_text</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">summarized_text</span>
</code></pre></div></p>
</li>
</ol>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../">MCP Package Overview</a> - Package architecture and design</li>
<li><a href="tools_server.md">Tools Server</a> - MCP server implementation</li>
<li><a href="../../datamodel/">Data Models</a> - Pydantic model definitions</li>
<li><a href="../model_registry.md">Model Registry</a> - LLM client management</li>
<li><a href="../../../examples/">Examples</a> - Usage examples and tutorials</li>
</ul>
<hr/>
<p><em>This class documentation is automatically generated from the source code and maintained in sync with the implementation.</em></p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
<script src="../../../javascripts/mathjax.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>