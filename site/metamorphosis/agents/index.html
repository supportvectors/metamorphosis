
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="A simple example with AI Agents" name="description"/>
<meta content="SupportVectors" name="author"/>
<link href="https://supportvectors.ai/metamorphosis/metamorphosis/agents/" rel="canonical"/>
<link href="../mcp/TextModifiers/" rel="prev"/>
<link href="../datamodel/" rel="next"/>
<link href="../../images/favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.18" name="generator"/>
<title>Overview - SupportVectors MetaMorphosis</title>
<link href="../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Lora:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Lora";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../stylesheets/supportvectors.css" rel="stylesheet"/>
<link href="../../css/ansi-colours.css" rel="stylesheet"/>
<link href="../../css/jupyter-cells.css" rel="stylesheet"/>
<link href="../../css/pandas-dataframe.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="gray" data-md-color-primary="light-blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#agents-package">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="SupportVectors MetaMorphosis" class="md-header__button md-logo" data-md-component="logo" href="../.." title="SupportVectors MetaMorphosis">
<img alt="logo" src="../../images/overlapping_logo.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            SupportVectors MetaMorphosis
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Overview
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="gray" data-md-color-media="" data-md-color-primary="light-blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="SupportVectors MetaMorphosis" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="SupportVectors MetaMorphosis">
<img alt="logo" src="../../images/overlapping_logo.png"/>
</a>
    SupportVectors MetaMorphosis
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/">
<span class="md-ellipsis">
    Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Package Documentation
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Package Documentation
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
<span class="md-ellipsis">
    MCP Package
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            MCP Package
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../mcp/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mcp/TextModifiers/">
<span class="md-ellipsis">
    TextModifiers
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-ellipsis">
    Agents Package
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            Agents Package
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Overview
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#package-architecture">
<span class="md-ellipsis">
      Package Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-components">
<span class="md-ellipsis">
      Core Components
    </span>
</a>
<nav aria-label="Core Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-fastapi-service-agent_servicepy">
<span class="md-ellipsis">
      1. FastAPI Service (agent_service.py)
    </span>
</a>
<nav aria-label="1. FastAPI Service (agent_service.py)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#endpoints">
<span class="md-ellipsis">
      Endpoints
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#features">
<span class="md-ellipsis">
      Features
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-langgraph-workflow-self_reviewerpy">
<span class="md-ellipsis">
      2. LangGraph Workflow (self_reviewer.py)
    </span>
</a>
<nav aria-label="2. LangGraph Workflow (self_reviewer.py)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-stages">
<span class="md-ellipsis">
      Workflow Stages
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#node-implementations">
<span class="md-ellipsis">
      Node Implementations
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-state-management-graphstate">
<span class="md-ellipsis">
      3. State Management (GraphState)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#module-documentation">
<span class="md-ellipsis">
      Module Documentation
    </span>
</a>
<nav aria-label="Module Documentation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-modules">
<span class="md-ellipsis">
      Core Modules
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-classes-and-functions">
<span class="md-ellipsis">
      Key Classes and Functions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-architecture">
<span class="md-ellipsis">
      Workflow Architecture
    </span>
</a>
<nav aria-label="Workflow Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#processing-flow">
<span class="md-ellipsis">
      Processing Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#state-transitions">
<span class="md-ellipsis">
      State Transitions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-reference">
<span class="md-ellipsis">
      API Reference
    </span>
</a>
<nav aria-label="API Reference" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#request-models">
<span class="md-ellipsis">
      Request Models
    </span>
</a>
<nav aria-label="Request Models" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#invokerequest">
<span class="md-ellipsis">
      InvokeRequest
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streamrequest">
<span class="md-ellipsis">
      StreamRequest
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#response-models">
<span class="md-ellipsis">
      Response Models
    </span>
</a>
<nav aria-label="Response Models" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#invokeresponse">
<span class="md-ellipsis">
      InvokeResponse
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usage-examples">
<span class="md-ellipsis">
      Usage Examples
    </span>
</a>
<nav aria-label="Usage Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#synchronous-processing">
<span class="md-ellipsis">
      Synchronous Processing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-processing">
<span class="md-ellipsis">
      Streaming Processing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python-client-integration">
<span class="md-ellipsis">
      Python Client Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
<span class="md-ellipsis">
      Configuration
    </span>
</a>
<nav aria-label="Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fastapi-service-configuration">
<span class="md-ellipsis">
      FastAPI Service Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cors-configuration">
<span class="md-ellipsis">
      CORS Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#environment-variables">
<span class="md-ellipsis">
      Environment Variables
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-features">
<span class="md-ellipsis">
      Advanced Features
    </span>
</a>
<nav aria-label="Advanced Features" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-based-state-persistence">
<span class="md-ellipsis">
      Thread-based State Persistence
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-strategy">
<span class="md-ellipsis">
      Error Handling Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-event-generation">
<span class="md-ellipsis">
      Streaming Event Generation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimization">
<span class="md-ellipsis">
      Performance Optimization
    </span>
</a>
<nav aria-label="Performance Optimization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parallel-processing">
<span class="md-ellipsis">
      Parallel Processing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resource-management">
<span class="md-ellipsis">
      Resource Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-and-observability">
<span class="md-ellipsis">
      Monitoring and Observability
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing">
<span class="md-ellipsis">
      Testing
    </span>
</a>
<nav aria-label="Testing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-tests">
<span class="md-ellipsis">
      Unit Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-tests">
<span class="md-ellipsis">
      Integration Tests
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deployment">
<span class="md-ellipsis">
      Deployment
    </span>
</a>
<nav aria-label="Deployment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#docker-deployment">
<span class="md-ellipsis">
      Docker Deployment
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#production-configuration">
<span class="md-ellipsis">
      Production Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#health-monitoring">
<span class="md-ellipsis">
      Health Monitoring
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#troubleshooting">
<span class="md-ellipsis">
      Troubleshooting
    </span>
</a>
<nav aria-label="Troubleshooting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#common-issues">
<span class="md-ellipsis">
      Common Issues
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debug-mode">
<span class="md-ellipsis">
      Debug Mode
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#see-also">
<span class="md-ellipsis">
      See Also
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-ellipsis">
    Core Modules
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            Core Modules
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../datamodel/">
<span class="md-ellipsis">
    Data Models
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../exceptions.md">
<span class="md-ellipsis">
    Exceptions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../utilities.md">
<span class="md-ellipsis">
    Utilities
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../model_registry.md">
<span class="md-ellipsis">
    Model Registry
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Examples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
<span class="md-ellipsis">
    Basic Processing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            Basic Processing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/summarizer_usage.md">
<span class="md-ellipsis">
    Summarizer Usage
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/rationalize_usage.md">
<span class="md-ellipsis">
    Copy Editor Usage
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
<span class="md-ellipsis">
    Advanced Processing
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            Advanced Processing
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/extract_achievements_usage/">
<span class="md-ellipsis">
    Achievement Extraction
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/review_text_evaluator_usage.md">
<span class="md-ellipsis">
    Quality Evaluation
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
<span class="md-ellipsis">
    Visualization
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            Visualization
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../examples/visualize_evaluation_radar.md">
<span class="md-ellipsis">
    Radar Charts
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Project Guide
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Project Guide
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
<span class="md-ellipsis">
    Tips &amp; Tricks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_1_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_1">
<span class="md-nav__icon md-icon"></span>
            Tips &amp; Tricks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../project-guide/tips-and-tricks/cuda-hell/">
<span class="md-ellipsis">
    CUDA Issues
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Notebooks
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../notebooks/supportvectors-common/">
<span class="md-ellipsis">
    Common Patterns
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#package-architecture">
<span class="md-ellipsis">
      Package Architecture
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-components">
<span class="md-ellipsis">
      Core Components
    </span>
</a>
<nav aria-label="Core Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-fastapi-service-agent_servicepy">
<span class="md-ellipsis">
      1. FastAPI Service (agent_service.py)
    </span>
</a>
<nav aria-label="1. FastAPI Service (agent_service.py)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#endpoints">
<span class="md-ellipsis">
      Endpoints
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#features">
<span class="md-ellipsis">
      Features
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-langgraph-workflow-self_reviewerpy">
<span class="md-ellipsis">
      2. LangGraph Workflow (self_reviewer.py)
    </span>
</a>
<nav aria-label="2. LangGraph Workflow (self_reviewer.py)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-stages">
<span class="md-ellipsis">
      Workflow Stages
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#node-implementations">
<span class="md-ellipsis">
      Node Implementations
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-state-management-graphstate">
<span class="md-ellipsis">
      3. State Management (GraphState)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#module-documentation">
<span class="md-ellipsis">
      Module Documentation
    </span>
</a>
<nav aria-label="Module Documentation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-modules">
<span class="md-ellipsis">
      Core Modules
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-classes-and-functions">
<span class="md-ellipsis">
      Key Classes and Functions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#workflow-architecture">
<span class="md-ellipsis">
      Workflow Architecture
    </span>
</a>
<nav aria-label="Workflow Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#processing-flow">
<span class="md-ellipsis">
      Processing Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#state-transitions">
<span class="md-ellipsis">
      State Transitions
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#api-reference">
<span class="md-ellipsis">
      API Reference
    </span>
</a>
<nav aria-label="API Reference" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#request-models">
<span class="md-ellipsis">
      Request Models
    </span>
</a>
<nav aria-label="Request Models" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#invokerequest">
<span class="md-ellipsis">
      InvokeRequest
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streamrequest">
<span class="md-ellipsis">
      StreamRequest
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#response-models">
<span class="md-ellipsis">
      Response Models
    </span>
</a>
<nav aria-label="Response Models" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#invokeresponse">
<span class="md-ellipsis">
      InvokeResponse
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usage-examples">
<span class="md-ellipsis">
      Usage Examples
    </span>
</a>
<nav aria-label="Usage Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#synchronous-processing">
<span class="md-ellipsis">
      Synchronous Processing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-processing">
<span class="md-ellipsis">
      Streaming Processing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python-client-integration">
<span class="md-ellipsis">
      Python Client Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
<span class="md-ellipsis">
      Configuration
    </span>
</a>
<nav aria-label="Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#fastapi-service-configuration">
<span class="md-ellipsis">
      FastAPI Service Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cors-configuration">
<span class="md-ellipsis">
      CORS Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#environment-variables">
<span class="md-ellipsis">
      Environment Variables
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-features">
<span class="md-ellipsis">
      Advanced Features
    </span>
</a>
<nav aria-label="Advanced Features" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#thread-based-state-persistence">
<span class="md-ellipsis">
      Thread-based State Persistence
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#error-handling-strategy">
<span class="md-ellipsis">
      Error Handling Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#streaming-event-generation">
<span class="md-ellipsis">
      Streaming Event Generation
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#performance-optimization">
<span class="md-ellipsis">
      Performance Optimization
    </span>
</a>
<nav aria-label="Performance Optimization" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#parallel-processing">
<span class="md-ellipsis">
      Parallel Processing
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resource-management">
<span class="md-ellipsis">
      Resource Management
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-and-observability">
<span class="md-ellipsis">
      Monitoring and Observability
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing">
<span class="md-ellipsis">
      Testing
    </span>
</a>
<nav aria-label="Testing" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-tests">
<span class="md-ellipsis">
      Unit Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-tests">
<span class="md-ellipsis">
      Integration Tests
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deployment">
<span class="md-ellipsis">
      Deployment
    </span>
</a>
<nav aria-label="Deployment" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#docker-deployment">
<span class="md-ellipsis">
      Docker Deployment
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#production-configuration">
<span class="md-ellipsis">
      Production Configuration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#health-monitoring">
<span class="md-ellipsis">
      Health Monitoring
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#troubleshooting">
<span class="md-ellipsis">
      Troubleshooting
    </span>
</a>
<nav aria-label="Troubleshooting" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#common-issues">
<span class="md-ellipsis">
      Common Issues
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#debug-mode">
<span class="md-ellipsis">
      Debug Mode
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#see-also">
<span class="md-ellipsis">
      See Also
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="agents-package">Agents Package<a class="headerlink" href="#agents-package" title="Permanent link">¶</a></h1>
<p>The <code>metamorphosis.agents</code> package implements LangGraph-based agent workflows for orchestrating multi-stage text processing operations. It provides both synchronous and asynchronous processing capabilities through a FastAPI service with real-time streaming support.</p>
<h2 id="package-architecture">Package Architecture<a class="headerlink" href="#package-architecture" title="Permanent link">¶</a></h2>
<div class="mermaid">graph TB
    subgraph "FastAPI Service Layer"
        A[agent_service.py<br/>REST API Endpoints]
        B[Request/Response Models<br/>Pydantic Schemas]
    end

    subgraph "LangGraph Workflow Layer"
        C[self_reviewer.py<br/>Workflow Definition]
        D[GraphState<br/>State Management]
        E[Workflow Nodes<br/>Processing Steps]
    end

    subgraph "Processing Integration"
        F[MCP Tools<br/>Text Processing]
        G[External Services<br/>Word Cloud Generation]
    end

    subgraph "State Management"
        H[Thread-based Storage<br/>Conversation Persistence]
        I[Streaming Events<br/>Real-time Updates]
    end

    A --&gt; C
    A --&gt; B
    C --&gt; D
    C --&gt; E
    E --&gt; F
    E --&gt; G
    D --&gt; H
    A --&gt; I
</div>
<h2 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">¶</a></h2>
<h3 id="1-fastapi-service-agent_servicepy">1. FastAPI Service (<code>agent_service.py</code>)<a class="headerlink" href="#1-fastapi-service-agent_servicepy" title="Permanent link">¶</a></h3>
<p>The main service provides REST API endpoints for text processing workflows:</p>
<h4 id="endpoints">Endpoints<a class="headerlink" href="#endpoints" title="Permanent link">¶</a></h4>
<ul>
<li><strong><code>POST /invoke</code></strong>: Synchronous workflow execution</li>
<li><strong><code>POST /stream</code></strong>: Asynchronous streaming workflow execution</li>
<li><strong><code>GET /docs</code></strong>: Interactive API documentation</li>
<li><strong><code>GET /health</code></strong>: Service health check</li>
</ul>
<h4 id="features">Features<a class="headerlink" href="#features" title="Permanent link">¶</a></h4>
<ul>
<li><strong>CORS Support</strong>: Configurable cross-origin resource sharing</li>
<li><strong>Error Handling</strong>: Comprehensive exception management</li>
<li><strong>Request Validation</strong>: Pydantic model validation</li>
<li><strong>Streaming Support</strong>: Server-Sent Events (SSE) for real-time updates</li>
<li><strong>Thread Management</strong>: Unique thread IDs for conversation persistence</li>
</ul>
<h3 id="2-langgraph-workflow-self_reviewerpy">2. LangGraph Workflow (<code>self_reviewer.py</code>)<a class="headerlink" href="#2-langgraph-workflow-self_reviewerpy" title="Permanent link">¶</a></h3>
<p>Implements a sophisticated multi-stage text processing workflow:</p>
<h4 id="workflow-stages">Workflow Stages<a class="headerlink" href="#workflow-stages" title="Permanent link">¶</a></h4>
<div class="mermaid">graph LR
    A[START] --&gt; B[Copy Editor Node]
    B --&gt; C[Summarizer Node]
    B --&gt; D[Word Cloud Node]
    C --&gt; E[END]
    D --&gt; E
</div>
<h4 id="node-implementations">Node Implementations<a class="headerlink" href="#node-implementations" title="Permanent link">¶</a></h4>
<ol>
<li><strong>Copy Editor Node</strong>: Text rationalization and improvement</li>
<li><strong>Summarizer Node</strong>: Abstractive summary generation (parallel)</li>
<li><strong>Word Cloud Node</strong>: Visual representation generation (parallel)</li>
</ol>
<h3 id="3-state-management-graphstate">3. State Management (<code>GraphState</code>)<a class="headerlink" href="#3-state-management-graphstate" title="Permanent link">¶</a></h3>
<p>Type-safe state management using TypedDict:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GraphState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">review_text</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Original input text</span>
    <span class="n">copy_edited_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># Processed text</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># Generated summary</span>
    <span class="n">word_cloud_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>  <span class="c1"># Generated visualization path</span>
</code></pre></div>
<h2 id="module-documentation">Module Documentation<a class="headerlink" href="#module-documentation" title="Permanent link">¶</a></h2>
<h3 id="core-modules">Core Modules<a class="headerlink" href="#core-modules" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Module</th>
<th>Description</th>
<th>Key Components</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="agent_service.md"><code>agent_service.py</code></a></td>
<td>FastAPI REST API service</td>
<td>Endpoints, middleware, error handling</td>
</tr>
<tr>
<td><a href="self_reviewer.md"><code>self_reviewer.py</code></a></td>
<td>LangGraph workflow implementation</td>
<td>Workflow nodes, state management</td>
</tr>
<tr>
<td><a href="agents_init.md"><code>__init__.py</code></a></td>
<td>Package initialization</td>
<td>Exports and configuration</td>
</tr>
</tbody>
</table>
<h3 id="key-classes-and-functions">Key Classes and Functions<a class="headerlink" href="#key-classes-and-functions" title="Permanent link">¶</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Purpose</th>
<th>Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="agent_service.md#fastapi-app"><code>FastAPI App</code></a></td>
<td>Main service application</td>
<td><a href="agent_service.md#fastapi-app">View Details →</a></td>
</tr>
<tr>
<td><a href="self_reviewer.md#graphstate"><code>GraphState</code></a></td>
<td>Workflow state definition</td>
<td><a href="self_reviewer.md#graphstate">View Details →</a></td>
</tr>
<tr>
<td><a href="self_reviewer.md#build-graph"><code>build_graph</code></a></td>
<td>Workflow construction</td>
<td><a href="self_reviewer.md#build-graph">View Details →</a></td>
</tr>
<tr>
<td><a href="self_reviewer.md#run-graph"><code>run_graph</code></a></td>
<td>Workflow execution</td>
<td><a href="self_reviewer.md#run-graph">View Details →</a></td>
</tr>
</tbody>
</table>
<h2 id="workflow-architecture">Workflow Architecture<a class="headerlink" href="#workflow-architecture" title="Permanent link">¶</a></h2>
<h3 id="processing-flow">Processing Flow<a class="headerlink" href="#processing-flow" title="Permanent link">¶</a></h3>
<div class="mermaid">sequenceDiagram
    participant Client
    participant FastAPI
    participant LangGraph
    participant CopyEditor
    participant Summarizer
    participant WordCloud

    Client-&gt;&gt;FastAPI: POST /stream
    FastAPI-&gt;&gt;FastAPI: Generate thread_id
    FastAPI-&gt;&gt;LangGraph: run_graph(text, thread_id)

    LangGraph-&gt;&gt;CopyEditor: Process text
    CopyEditor-&gt;&gt;LangGraph: Edited text

    par Parallel Processing
        LangGraph-&gt;&gt;Summarizer: Generate summary
        Summarizer-&gt;&gt;LangGraph: Summary result
    and
        LangGraph-&gt;&gt;WordCloud: Create visualization
        WordCloud-&gt;&gt;LangGraph: Image path
    end

    LangGraph-&gt;&gt;FastAPI: Stream events
    FastAPI-&gt;&gt;Client: SSE events
</div>
<h3 id="state-transitions">State Transitions<a class="headerlink" href="#state-transitions" title="Permanent link">¶</a></h3>
<div class="mermaid">stateDiagram-v2
    [*] --&gt; Initial
    Initial --&gt; CopyEditing: Start workflow
    CopyEditing --&gt; Processing: Text edited
    Processing --&gt; Summarizing: Parallel branch 1
    Processing --&gt; WordCloudGen: Parallel branch 2
    Summarizing --&gt; Complete: Summary done
    WordCloudGen --&gt; Complete: Word cloud done
    Complete --&gt; [*]: All tasks finished
</div>
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">¶</a></h2>
<h3 id="request-models">Request Models<a class="headerlink" href="#request-models" title="Permanent link">¶</a></h3>
<h4 id="invokerequest">InvokeRequest<a class="headerlink" href="#invokerequest" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InvokeRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">review_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">thread_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Optional thread ID"</span><span class="p">)</span>
</code></pre></div>
<h4 id="streamrequest">StreamRequest<a class="headerlink" href="#streamrequest" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">StreamRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">review_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">thread_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Optional thread ID"</span><span class="p">)</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">"values"</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">"Streaming mode"</span><span class="p">)</span>
</code></pre></div>
<h3 id="response-models">Response Models<a class="headerlink" href="#response-models" title="Permanent link">¶</a></h3>
<h4 id="invokeresponse">InvokeResponse<a class="headerlink" href="#invokeresponse" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InvokeResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">copy_edited_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">word_cloud_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>
<h2 id="usage-examples">Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">¶</a></h2>
<h3 id="synchronous-processing">Synchronous Processing<a class="headerlink" href="#synchronous-processing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
    <span class="s2">"http://localhost:8001/invoke"</span><span class="p">,</span>
    <span class="n">json</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">"review_text"</span><span class="p">:</span> <span class="s2">"I worked on improving system performance this quarter..."</span><span class="p">,</span>
        <span class="s2">"thread_id"</span><span class="p">:</span> <span class="s2">"user-123"</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Edited text: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">'copy_edited_text'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Summary: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">'summary'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Word cloud: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="s1">'word_cloud_path'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="streaming-processing">Streaming Processing<a class="headerlink" href="#streaming-processing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">def</span><span class="w"> </span><span class="nf">stream_processing</span><span class="p">(</span><span class="n">review_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">"http://localhost:8001/stream"</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"review_text"</span><span class="p">:</span> <span class="n">review_text</span><span class="p">,</span>
            <span class="s2">"mode"</span><span class="p">:</span> <span class="s2">"values"</span>
        <span class="p">},</span>
        <span class="n">stream</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_lines</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s2">"data:"</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>  <span class="c1"># Remove "data:" prefix</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Event: </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

            <span class="c1"># Process real-time updates</span>
            <span class="k">if</span> <span class="s2">"copy_edited_text"</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Copy editing complete: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">'copy_edited_text'</span><span class="p">][:</span><span class="mi">100</span><span class="p">]</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">"summary"</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Summary ready: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">'summary'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="python-client-integration">Python Client Integration<a class="headerlink" href="#python-client-integration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">metamorphosis.agents.self_reviewer</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_graph</span><span class="p">,</span> <span class="n">build_graph</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_review</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"default"</span><span class="p">):</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="k">await</span> <span class="n">build_graph</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">run_graph</span><span class="p">(</span>
        <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
        <span class="n">review_text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
        <span class="n">thread_id</span><span class="o">=</span><span class="n">thread_id</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing event: </span><span class="si">{</span><span class="n">event</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Handle different event types</span>
        <span class="k">if</span> <span class="s2">"copy_edited_text"</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="c1"># Copy editing completed</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="s2">"summary"</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="c1"># Summarization completed</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="s2">"word_cloud_path"</span> <span class="ow">in</span> <span class="n">event</span><span class="p">:</span>
            <span class="c1"># Visualization completed</span>
            <span class="k">pass</span>
</code></pre></div>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">¶</a></h2>
<h3 id="fastapi-service-configuration">FastAPI Service Configuration<a class="headerlink" href="#fastapi-service-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"LangGraph for FastAPI Service"</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">"A FastAPI service for processing self-review texts"</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="s2">"1.0.0"</span><span class="p">,</span>
    <span class="n">docs_url</span><span class="o">=</span><span class="s2">"/docs"</span><span class="p">,</span>
    <span class="n">redoc_url</span><span class="o">=</span><span class="s2">"/redoc"</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="cors-configuration">CORS Configuration<a class="headerlink" href="#cors-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>  <span class="c1"># Configure for production</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="environment-variables">Environment Variables<a class="headerlink" href="#environment-variables" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Service configuration</span>
<span class="nv">FASTAPI_HOST</span><span class="o">=</span><span class="m">0</span>.0.0.0
<span class="nv">FASTAPI_PORT</span><span class="o">=</span><span class="m">8001</span>

<span class="c1"># OpenAI configuration</span>
<span class="nv">OPENAI_API_KEY</span><span class="o">=</span>sk-...

<span class="c1"># Project configuration</span>
<span class="nv">PROJECT_ROOT_DIR</span><span class="o">=</span>/path/to/project
</code></pre></div>
<h2 id="advanced-features">Advanced Features<a class="headerlink" href="#advanced-features" title="Permanent link">¶</a></h2>
<h3 id="thread-based-state-persistence">Thread-based State Persistence<a class="headerlink" href="#thread-based-state-persistence" title="Permanent link">¶</a></h3>
<p>The service maintains conversation state using unique thread IDs:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_generate_thread_id</span><span class="p">(</span><span class="n">provided_thread_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">provided_thread_id</span> <span class="ow">and</span> <span class="n">provided_thread_id</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">provided_thread_id</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</code></pre></div>
<h3 id="error-handling-strategy">Error Handling Strategy<a class="headerlink" href="#error-handling-strategy" title="Permanent link">¶</a></h3>
<p>Comprehensive error handling with structured responses:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_create_error_response</span><span class="p">(</span><span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status_code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
        <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span><span class="p">,</span>
        <span class="n">content</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"error"</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
            <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"error"</span>
        <span class="p">}</span>
    <span class="p">)</span>
</code></pre></div>
<h3 id="streaming-event-generation">Streaming Event Generation<a class="headerlink" href="#streaming-event-generation" title="Permanent link">¶</a></h3>
<p>Real-time event streaming using Server-Sent Events:</p>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_generate_stream_events</span><span class="p">(</span>
    <span class="n">review_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">thread_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
    <span class="n">request</span><span class="p">:</span> <span class="n">Request</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="k">await</span> <span class="n">build_graph</span><span class="p">()</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">run_graph</span><span class="p">(</span>
            <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
            <span class="n">review_text</span><span class="o">=</span><span class="n">review_text</span><span class="p">,</span>
            <span class="n">thread_id</span><span class="o">=</span><span class="n">thread_id</span>
        <span class="p">):</span>
            <span class="c1"># Format and yield SSE event</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="s2">"data: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"error"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span> <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"error"</span><span class="p">}</span>
        <span class="k">yield</span> <span class="sa">f</span><span class="s2">"data: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">error_data</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
</code></pre></div>
<h2 id="performance-optimization">Performance Optimization<a class="headerlink" href="#performance-optimization" title="Permanent link">¶</a></h2>
<h3 id="parallel-processing">Parallel Processing<a class="headerlink" href="#parallel-processing" title="Permanent link">¶</a></h3>
<p>The workflow implements parallel execution for independent tasks:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Copy editing happens first (required for other tasks)</span>
<span class="n">copy_edited_text</span> <span class="o">=</span> <span class="k">await</span> <span class="n">copy_editor_node</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

<span class="c1"># Summarization and word cloud generation run in parallel</span>
<span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
    <span class="n">summarizer_node</span><span class="p">(</span><span class="n">state</span><span class="p">),</span>
    <span class="n">wordcloud_node</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="resource-management">Resource Management<a class="headerlink" href="#resource-management" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Connection Pooling</strong>: Efficient HTTP connection reuse</li>
<li><strong>Memory Management</strong>: Proper cleanup of large processing results</li>
<li><strong>Token Optimization</strong>: Efficient prompt design and caching</li>
</ul>
<h3 id="monitoring-and-observability">Monitoring and Observability<a class="headerlink" href="#monitoring-and-observability" title="Permanent link">¶</a></h3>
<ul>
<li><strong>Structured Logging</strong>: Comprehensive operation tracking</li>
<li><strong>Error Context</strong>: Rich error information for debugging</li>
<li><strong>Performance Metrics</strong>: Processing time and resource usage tracking</li>
</ul>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">¶</a></h2>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">metamorphosis.agents.self_reviewer</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_graph</span><span class="p">,</span> <span class="n">run_graph</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_workflow_construction</span><span class="p">():</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="k">await</span> <span class="n">build_graph</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">graph</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="s1">'nodes'</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_workflow_execution</span><span class="p">():</span>
    <span class="n">graph</span> <span class="o">=</span> <span class="k">await</span> <span class="n">build_graph</span><span class="p">()</span>
    <span class="n">events</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">run_graph</span><span class="p">(</span>
        <span class="n">graph</span><span class="o">=</span><span class="n">graph</span><span class="p">,</span>
        <span class="n">review_text</span><span class="o">=</span><span class="s2">"Test review text"</span><span class="p">,</span>
        <span class="n">thread_id</span><span class="o">=</span><span class="s2">"test-123"</span>
    <span class="p">):</span>
        <span class="n">events</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">any</span><span class="p">(</span><span class="s2">"copy_edited_text"</span> <span class="ow">in</span> <span class="n">event</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">)</span>
</code></pre></div>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_invoke_endpoint</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">"http://localhost:8001/invoke"</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"review_text"</span><span class="p">:</span> <span class="s2">"Test review for processing"</span><span class="p">,</span>
            <span class="s2">"thread_id"</span><span class="p">:</span> <span class="s2">"test-thread"</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">assert</span> <span class="s2">"copy_edited_text"</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="k">assert</span> <span class="s2">"summary"</span> <span class="ow">in</span> <span class="n">data</span>
    <span class="k">assert</span> <span class="s2">"word_cloud_path"</span> <span class="ow">in</span> <span class="n">data</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_streaming_endpoint</span><span class="p">():</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s2">"http://localhost:8001/stream"</span><span class="p">,</span>
        <span class="n">json</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">"review_text"</span><span class="p">:</span> <span class="s2">"Test streaming review"</span><span class="p">,</span>
            <span class="s2">"mode"</span><span class="p">:</span> <span class="s2">"values"</span>
        <span class="p">},</span>
        <span class="n">stream</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">"content-type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"text/plain"</span>
</code></pre></div>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">¶</a></h2>
<h3 id="docker-deployment">Docker Deployment<a class="headerlink" href="#docker-deployment" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.12-slim</span>

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
<span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt

<span class="k">COPY</span><span class="w"> </span>src/<span class="w"> </span>./src/
<span class="k">COPY</span><span class="w"> </span>config.yaml<span class="w"> </span>.
<span class="k">COPY</span><span class="w"> </span>prompts/<span class="w"> </span>./prompts/

<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">"python"</span><span class="p">,</span><span class="w"> </span><span class="s2">"-m"</span><span class="p">,</span><span class="w"> </span><span class="s2">"metamorphosis.agents.agent_service"</span><span class="p">]</span>
</code></pre></div>
<h3 id="production-configuration">Production Configuration<a class="headerlink" href="#production-configuration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Use production-ready settings</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">"Metamorphosis Agent Service"</span><span class="p">,</span>
    <span class="n">docs_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Disable in production</span>
    <span class="n">redoc_url</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Disable in production</span>
<span class="p">)</span>

<span class="c1"># Configure CORS for specific origins</span>
<span class="n">app</span><span class="o">.</span><span class="n">add_middleware</span><span class="p">(</span>
    <span class="n">CORSMiddleware</span><span class="p">,</span>
    <span class="n">allow_origins</span><span class="o">=</span><span class="p">[</span><span class="s2">"https://your-domain.com"</span><span class="p">],</span>
    <span class="n">allow_credentials</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">allow_methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">],</span>
    <span class="n">allow_headers</span><span class="o">=</span><span class="p">[</span><span class="s2">"*"</span><span class="p">],</span>
<span class="p">)</span>
</code></pre></div>
<h3 id="health-monitoring">Health Monitoring<a class="headerlink" href="#health-monitoring" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/health"</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"healthy"</span><span class="p">,</span>
        <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
        <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"1.0.0"</span>
    <span class="p">}</span>
</code></pre></div>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">¶</a></h2>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">¶</a></h3>
<ol>
<li><strong>Service Startup Errors</strong>:</li>
<li>Check OpenAI API key configuration</li>
<li>Verify all dependencies are installed</li>
<li>
<p>Ensure port availability</p>
</li>
<li>
<p><strong>Workflow Execution Failures</strong>:</p>
</li>
<li>Monitor LLM API rate limits</li>
<li>Check prompt template availability</li>
<li>
<p>Verify MCP tools server connectivity</p>
</li>
<li>
<p><strong>Streaming Issues</strong>:</p>
</li>
<li>Ensure proper SSE client implementation</li>
<li>Check network connectivity and timeouts</li>
<li>Monitor memory usage for large texts</li>
</ol>
<h3 id="debug-mode">Debug Mode<a class="headerlink" href="#debug-mode" title="Permanent link">¶</a></h3>
<p>Enable detailed logging:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

<span class="c1"># Run service with debug mode</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="s2">"metamorphosis.agents.agent_service:app"</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="s2">"0.0.0.0"</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">,</span>
        <span class="n">log_level</span><span class="o">=</span><span class="s2">"debug"</span>
    <span class="p">)</span>
</code></pre></div>
<h2 id="see-also">See Also<a class="headerlink" href="#see-also" title="Permanent link">¶</a></h2>
<ul>
<li><a href="../mcp/">MCP Package</a> - Text processing tools integration</li>
<li><a href="../ui/index.md">UI Package</a> - Streamlit user interface</li>
<li><a href="../datamodel/">Data Models</a> - Request/response schemas</li>
<li><a href="../../examples/">Examples</a> - Usage examples and tutorials</li>
</ul>
<hr/>
<p><em>This documentation is automatically generated from the source code and maintained in sync with the codebase.</em></p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
mermaid.initialize({});</script></body>
</html>